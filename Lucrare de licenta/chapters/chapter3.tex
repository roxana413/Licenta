\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}
\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}

\lstset{style=mystyle}
\chapter{Implementarea și verificarea în Dafny a algoritmului}

\section{Reprezentarea datelor de intrare și predicate specifice }

Pentru a defini o activitate am folosit un tuplu, reprezentat în Dafny prin următorul tip algebric de date 
\begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{datatype} \PY{n+nc}{Job} \PY{o}{=} \PY{n}{Tuple}\PY{p}{(}\PY{n}{jobStart}\PY{p}{:} \PY{k+kt}{int}\PY{p}{,} \PY{n}{jobEnd}\PY{p}{:} \PY{k+kt}{int}\PY{p}{,} \PY{n}{profit}\PY{p}{:} \PY{k+kt}{int}\PY{p}{)}
\end{Verbatim}
unde:
\begin{itemize}
    \item \texttt{Job} este numele tipului de date, 
    \item \texttt{Tuple} este singurul constructor,
    \item iar \texttt{jobStart, jobEnd, profit} sunt destructori.
\end{itemize}

Problema de selecție a activităților are ca date de intrare un singur parametru:
\begin{itemize}
    \item \texttt{jobs} de tipul \texttt{seq$<$Job$>$} : reprezintă secvența de activități 
\end{itemize}

Tipul de date \texttt{Seq} reprezintă o secvență (sau listă) de elemente. Secvențele în Dafny sunt imuabile, ceea ce înseamnă că, odată create, nu pot fi modificate. Cu toate acestea, se pot crea noi secvențe prin operații pe secvențe existente.\\

Un \textbf{predicat} este o funcție care returnează o valoare booleană\citep{DBLP:series/natosec/KoenigL12}. Acestea sunt folosite ca precondiții și postcondiții în metode. Predicatele pe care le-am folosit la validarea datelor de intrare sunt:
\begin{itemize}
    \item Predicatul \texttt{validJob(jobs: Job)} verifică dacă numerele din tuplu pot reprezenta timpul de început, timpul de final și profitul unei activități. 
Am ales ca timpul de început să fie strict mai mic decât timpul de încheiere, deoarece nu permitem activități de dimensiune 0. 
Profitul am ales sa fie pozitiv, deoarece activitățile cu un profit negativ ar aduce un profit mai mic.
\begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{predicate} \PY{n+nf}{validJob}\PY{p}{(}\PY{n}{job}\PY{p}{:} \PY{n}{Job}\PY{p}{)}
\PY{p}{\PYZob{}}
  \PY{n}{job}\PY{p}{.}\PY{n}{jobStart} \PY{o}{\PYZlt{}} \PY{n}{job}\PY{p}{.}\PY{n}{jobEnd} \PY{o}{\PYZam{}\PYZam{}} \PY{n}{job}\PY{p}{.}\PY{n}{profit} \PY{o}{\PYZgt{}=} \PY{l+m+mi}{0}
\PY{p}{\PYZcb{}} 
\end{Verbatim} 
    \item Predicatul \texttt{validJobsSeq(jobs: seq<Job>)} verifică proprietatea de \\\texttt{validJob} pentru toată secvența de activități primită ca date de intrare. \begin{Verbatim}[commandchars=\\\{\},fontsize=\footnotesize]
\PY{k+kd}{predicate} \PY{n+nf}{validJobsSeq}\PY{p}{(}\PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{)}
\PY{p}{\PYZob{}}
  \PY{k}{forall} \PY{n}{job} \PY{p}{::} \PY{n}{job} \PY{o}{in} \PY{n}{jobs} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{validJob}\PY{p}{(}\PY{n}{job}\PY{p}{)}
\PY{p}{\PYZcb{}}
\end{Verbatim} 
    \item Predicatul \texttt{JobComparator (job1: Job, job2: Job)} compară două activități după timpul de încheiere.\begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{predicate} \PY{n+nf}{JobComparator}\PY{p}{(}\PY{n}{job1}\PY{p}{:} \PY{n}{Job}\PY{p}{,} \PY{n}{job2}\PY{p}{:} \PY{n}{Job}\PY{p}{)}
\PY{p}{\PYZob{}}
  \PY{n}{job1}\PY{p}{.}\PY{n}{jobEnd} \PY{o}{\PYZlt{}=} \PY{n}{job2}\PY{p}{.}\PY{n}{jobEnd}
\PY{p}{\PYZcb{}}
\end{Verbatim}

    \item Predicatul \texttt{sortedByActEnd(s: seq$<$Job$>$)} ne asigură că secvența de activități conține activități sortate după timpul de încheiere. Acest lucru este important pentru a putea împărți problema în subprobleme.   \begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{predicate} \PY{n+nf}{sortedByActEnd}\PY{p}{(}\PY{n}{s}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validJobsSeq}\PY{p}{(}\PY{n}{s}\PY{p}{)}
\PY{p}{\PYZob{}}
  \PY{k}{forall} \PY{n}{i}\PY{p}{,} \PY{n}{j} \PY{p}{::} \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{i} \PY{o}{\PYZlt{}} \PY{n}{j} \PY{o}{\PYZlt{}} \PY{o}{|}\PY{n}{s}\PY{o}{|} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{JobComparator}\PY{p}{(}\PY{n}{s}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{s}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)}
\PY{p}{\PYZcb{}}
\end{Verbatim}
    \item Predicatul \texttt{distinctJobs(j1: Job, j2: Job)} compară două activități și asigură că ele diferă prin cel puțin un timp. Nu comparăm profitul deoarece permitem activități cu același profit.  \begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{predicate}  \PY{n+nf}{distinctJobs}\PY{p}{(}\PY{n}{j1}\PY{p}{:} \PY{n}{Job}\PY{p}{,} \PY{n}{j2}\PY{p}{:} \PY{n}{Job}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validJob}\PY{p}{(}\PY{n}{j1}\PY{p}{)} \PY{o}{\PYZam{}\PYZam{}} \PY{n}{validJob}\PY{p}{(}\PY{n}{j2}\PY{p}{)}
\PY{p}{\PYZob{}}
  \PY{n}{j1}\PY{p}{.}\PY{n}{jobStart} \PY{o}{!=} \PY{n}{j2}\PY{p}{.}\PY{n}{jobStart} \PY{o}{|}\PY{o}{|} \PY{n}{j1}\PY{p}{.}\PY{n}{jobEnd} \PY{o}{!=} \PY{n}{j2}\PY{p}{.}\PY{n}{jobEnd}
\PY{p}{\PYZcb{}}
\end{Verbatim}
    \item Predicatul \texttt{distinctJobsSeq(s: seq$<$Job$>$)} verifică proprietatea de \\
    \texttt{distinctJobs} pentru toată secvența de activități.
\begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{predicate} \PY{n+nf}{distinctJobsSeq}\PY{p}{(}\PY{n}{s}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validJobsSeq}\PY{p}{(}\PY{n}{s}\PY{p}{)}
\PY{p}{\PYZob{}}
  \PY{k}{forall} \PY{n}{i}\PY{p}{,} \PY{n}{j} \PY{p}{::} \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{i} \PY{o}{\PYZlt{}} \PY{n}{j} \PY{o}{\PYZlt{}} \PY{o}{|}\PY{n}{s}\PY{o}{|} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{distinctJobs}\PY{p}{(}\PY{n}{s}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{s}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\item Predicatul \texttt{validProblem(jobs: seq<Job>)} este folosit pentru a defini ce înseamnă date de intrare valide. Pentru a defini predicatul \texttt{validProblem(jobs: seq<Job>)} am folosit predicatele \texttt{validJobsSeq(jobs: seq<Job>)}, \\\texttt{sortedByActEnd(s: seq$<$Job$>$)}, \texttt{distinctJobsSeq(s: seq$<$Job$>$)}. Am ales \texttt{1 <= |jobs|} pentru a nu permite date de intrare triviale. 

\begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{predicate} \PY{n+nf}{validProblem}\PY{p}{(}\PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{)}
\PY{p}{\PYZob{}}
  \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{jobs}\PY{o}{|} \PY{o}{\PYZam{}\PYZam{}} \PY{n}{validJobsSeq}\PY{p}{(}\PY{n}{jobs}\PY{p}{)} \PY{o}{\PYZam{}\PYZam{}} \PY{n}{sortedByActEnd}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
   \PY{o}{\PYZam{}\PYZam{}} \PY{n}{distinctJobsSeq}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{itemize}



\section{Reprezentarea soluțiilor parțiale și predicate specifice}

O soluție parțială este un vector caracteristic pentru un prefix al secvenței de activități primită la intrare, alcătuit doar din valori binare, unde 1 reprezintă că activitatea a fost selectată, iar 0 reprezintă că aceasta nu a fost selectată. 

Predicatele pe care le-am folosit pentru validarea soluțiilor parțiale sunt: 

\begin{itemize}
    \item 
    Predicatul \texttt{overlappingJobs(j1: Job, j2: Job)} verifică dacă activitățile se suprapun. Două activități se suprapun, dacă prima se termină înainte ca cealaltă să înceapă și invers. \begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{predicate} \PY{n+nf}{overlappingJobs}\PY{p}{(}\PY{n}{j1}\PY{p}{:}\PY{n}{Job}\PY{p}{,} \PY{n}{j2}\PY{p}{:}\PY{n}{Job}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validJob}\PY{p}{(}\PY{n}{j1}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validJob}\PY{p}{(}\PY{n}{j2}\PY{p}{)}
\PY{p}{\PYZob{}}
  \PY{n}{j1}\PY{p}{.}\PY{n}{jobEnd} \PY{o}{\PYZgt{}} \PY{n}{j2}\PY{p}{.}\PY{n}{jobStart} \PY{o}{\PYZam{}\PYZam{}}  \PY{n}{j2}\PY{p}{.}\PY{n}{jobEnd} \PY{o}{\PYZgt{}} \PY{n}{j1}\PY{p}{.}\PY{n}{jobStart} 
\PY{p}{\PYZcb{}}
\end{Verbatim}
    \item 
    Predicatul \texttt{hasNoOverlappingJobs(partialSol:seq<int>, jobs:seq<Job>)} verifică pentru o soluție parțială, să nu conțină activități care să se suprapună.  
\begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{predicate} \PY{n+nf}{hasNoOverlappingJobs}\PY{p}{(}\PY{n}{partialSol}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,}
    \PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validJobsSeq}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
\PY{p}{\PYZob{}}
  \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}  \PY{o}{\PYZam{}\PYZam{}} \PY{k}{forall} \PY{n}{i}\PY{p}{,} \PY{n}{j} \PY{p}{::} \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{i} \PY{o}{\PYZlt{}} \PY{n}{j} \PY{o}{\PYZlt{}} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|}
   \PY{o}{==}\PY{o}{\PYZgt{}} \PY{p}{(}\PY{n}{partialSol}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{==} \PY{l+m+mi}{1} \PY{o}{\PYZam{}\PYZam{}} \PY{n}{partialSol}\PY{p}{[}\PY{n}{j}\PY{p}{]} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{)}
    \PY{o}{==}\PY{o}{\PYZgt{}} \PY{err}{!}\PY{n}{overlappingJobs}\PY{p}{(}\PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{)}
\PY{p}{\PYZcb{}} 
\end{Verbatim}
    \item 
    Cu ajutorul predicatului \texttt{isPartialSol(partialSol: seq$<$int$>$, jobs: seq$<$Job$>$, length: int)} am verificat proprietatea de soluție parțială: secvența să conțină doar valori de 0 și 1, activitățile care corespund acestui vector caracteristic să nu se suprapună și să aibă lungimea dorită. 
\begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{predicate} \PY{n+nf}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{,} 
\PY{n}{length}\PY{p}{:} \PY{k+kt}{int}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validJobsSeq}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
\PY{p}{\PYZob{}}   
  \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{length} \PY{o}{\PYZam{}\PYZam{}} \PY{k}{forall} \PY{n}{i} \PY{p}{::} \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{i} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}
    \PY{o}{==}\PY{o}{\PYZgt{}} \PY{p}{(}\PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{partialSol}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{\PYZlt{}=} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{\PYZam{}\PYZam{}}
     \PY{n}{hasNoOverlappingJobs}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{)}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{itemize}


\subsection{Funcții importante folosite}
Funcțiile reprezintă un element important pe care le-am folosit la verificarea corectitudinii algoritmului ales. 
Funcțiile în Dafny sunt asemănătoare funcțiilor matematice, fiind constituite dintr-o singură instrucțiune al cărui tip de return este menționat în antetul acestora. Acestea sunt prezente doar
la compilare și nu pot avea efecte secundare \citep{DBLP:journals/jlap/BlazquezMS23}.
Una din funcțiile pe care am folosit-o cel mai des este funcția: 

\begin{Verbatim}[commandchars=\\\{\},fontsize=\footnotesize]
\PY{k+kd}{function} \PY{n+nf}{PartialSolProfit}\PY{p}{(}\PY{n}{solution}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{index}\PY{p}{:} \PY{k+kt}{int}\PY{p}{)}\PY{p}{:} \PY{k+kt}{int}
\end{Verbatim}
cu ajutorul căreia calculez profitul unei soluții parțiale, după formula \[ \sum_{i=0}^{|partialSol|} partialSol[i] * jobs[i]. \]

\begin{Verbatim}[commandchars=\\\{\},fontsize=\footnotesize]
\PY{k+kd}{function} \PY{n+nf}{PartialSolProfit}\PY{p}{(}\PY{n}{solution}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{index}\PY{p}{:} \PY{k+kt}{int}\PY{p}{)}
    \PY{p}{:}\PY{k+kt}{int}
  \PY{k}{requires} \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{index} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{solution}\PY{o}{|} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
  \PY{k}{decreases} \PY{o}{|}\PY{n}{solution}\PY{o}{|} \PY{o}{\PYZhy{}} \PY{n}{index}
  \PY{k}{ensures} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{solution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{index}\PY{p}{)} \PY{o}{==} 
    \PY{k}{if} \PY{n}{index} \PY{o}{==} \PY{o}{|}\PY{n}{solution}\PY{o}{|} \PY{k}{then} \PY{l+m+mi}{0} \PY{k}{else}
        \PY{n}{solution}\PY{p}{[}\PY{n}{index}\PY{p}{]} \PY{o}{*} \PY{n}{jobs}\PY{p}{[}\PY{n}{index}\PY{p}{]}\PY{p}{.}\PY{n}{profit} \PY{o}{+} 
            \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{solution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{index} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
\PY{p}{\PYZob{}}

  \PY{k}{if} \PY{n}{index} \PY{o}{==} \PY{o}{|}\PY{n}{solution}\PY{o}{|} \PY{k}{then} \PY{l+m+mi}{0} \PY{k}{else} 
    \PY{n}{solution}\PY{p}{[}\PY{n}{index}\PY{p}{]} \PY{o}{*} \PY{n}{jobs}\PY{p}{[}\PY{n}{index}\PY{p}{]}\PY{p}{.}\PY{n}{profit} \PY{o}{+}
     \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{solution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{index} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
\PY{p}{\PYZcb{}}
\end{Verbatim}

\section{Reprezentarea soluțiilor parțiale optime}

O soluție parțială optimă este o soluție parțială care aduce un profit maxim. 

Pentru a valida soluțiile parțiale am folosit următoarele predicate: 

\begin{itemize}
    \item Predicatul \texttt{hasLessProf} verifică profitul unei secvențe să fie mai mic sau egal cu un \texttt{maxProfit}. 
    \begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{predicate} \PY{n+nf}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{,}  
\PY{n}{maxProfit}\PY{p}{:} \PY{k+kt}{int}\PY{p}{,}\PY{n}{position}\PY{p}{:} \PY{k+kt}{int}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validJobsSeq}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
  \PY{k}{requires} \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{position} \PY{o}{\PYZlt{}} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
\PY{p}{\PYZob{}}
  \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{position}\PY{p}{)} \PY{o}{\PYZlt{}=} \PY{n}{maxProfit}
\PY{p}{\PYZcb{}}
\end{Verbatim}
    \item Predicatul \texttt{isOptParSol} verifică dacă o soluție parțiala este și optimă. O soluție parțială este optimă dacă orice altă soluție parțială pentru aceeași subproblemă are un profit mai mic sau egal decât profitul acesteia. Predicate \texttt{ghost} sunt folosite pentru specificare și verificare, dar nu au impact asupra execuției, fiind șterse la compilare. 
    \begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{ghost} \PY{k+kd}{predicate} \PY{n+nf}{isOptParSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{,}\PY{n}{length}\PY{p}{:} \PY{k+kt}{int}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validJobsSeq}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
  \PY{k}{requires} \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{jobs}\PY{o}{|} 
  \PY{k}{requires} \PY{n}{length} \PY{o}{==} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|}
  \PY{k}{requires} \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
\PY{p}{\PYZob{}}
  \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{length}\PY{p}{)} \PY{o}{\PYZam{}\PYZam{}}
  \PY{k}{forall} \PY{n}{otherSol} \PY{p}{::} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{otherSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{length}\PY{p}{)}
   \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{otherSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,}
    \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
\PY{p}{\PYZcb{}}
\end{Verbatim}
    \item Predicatul \texttt{isOptParSolDP} verifică o secvență să fie o soluție parțială optimă pentru o subproblemă și să aibă profitul optim.
    \begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{ghost} \PY{k+kd}{predicate} \PY{n+nf}{isOptParSolDP}\PY{p}{(}\PY{n}{partialSol}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{,}
 \PY{n}{length} \PY{p}{:} \PY{k+kt}{int}\PY{p}{,} \PY{n}{profit}\PY{p}{:}\PY{k+kt}{int}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validJobsSeq}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
  \PY{k}{requires} \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|}
  \PY{k}{requires} \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{n}{length} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
\PY{p}{\PYZob{}}
  \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{length} \PY{o}{\PYZam{}\PYZam{}} \PY{n}{isOptParSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{length}\PY{p}{)}
   \PY{o}{\PYZam{}\PYZam{}} \PY{n}{HasProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{,}  \PY{n}{profit}\PY{p}{)}
\PY{p}{\PYZcb{}}
\end{Verbatim}
    \item 
    Predicatul \texttt{OptParSolutions} verifică pentru o secvență de secvențe:
\begin{enumerate}
    \item fiecare secventă să corespundă subproblemei pe care o rezolvă
    \item fiecare secventă să fie o soluție parțială optimă
    \item fiecare secventă să aibă profitul optim
\end{enumerate}
\begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{ghost} \PY{k+kd}{predicate} \PY{n+nf}{OptParSolutions}\PY{p}{(}\PY{n}{allSol}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{,}
 \PY{n}{dp}\PY{p}{:}\PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{index}\PY{p}{:} \PY{k+kt}{int}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validJobsSeq}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
  \PY{k}{requires} \PY{o}{|}\PY{n}{dp}\PY{o}{|} \PY{o}{==} \PY{o}{|}\PY{n}{allSol}\PY{o}{|} \PY{o}{==} \PY{n}{index}
  \PY{k}{requires} \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{n}{index} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
\PY{p}{\PYZob{}}
  \PY{k}{forall} \PY{n}{i} \PY{p}{:} \PY{k+kt}{int} \PY{p}{::} \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{i} \PY{o}{\PYZlt{}} \PY{n}{index} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{o}{|}\PY{n}{allSol}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1} 
   \PY{o}{\PYZam{}\PYZam{}} \PY{n}{isOptParSolDP}\PY{p}{(}\PY{n}{allSol}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{dp}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}
\PY{p}{\PYZcb{}}
\end{Verbatim}

\end{itemize}

\section{Punctul de intrare în algoritm}
Variabilele locale folosite pentru rezolvarea algoritmului pentru problema de selecție a activităților cu profit maxim sunt:
\begin{itemize}
    \item \texttt{solution} de tipul \textit{seq$<$int$>$}: reprezintă soluția parțială optimă obținută la fiecare iterație
    \item \texttt{dp} de tipul \textit{seq$<$int$>$}:
    conține toate profiturile optime obținute la fiecare pas
    \item \texttt{allSol} de tipul \textit{seq$<$seq$<$int$>$$>$}:
    conține soluțiile parțiale optime obținute la fiecare pas
    \item \texttt{partialSol} de tipul \textit{seq$<$int$>$}: reprezintă o soluție parțială   
\end{itemize}

Iată punctul de intrare în algoritm: 
\begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{method} \PY{n+nf}{WeightedJobScheduling}\PY{p}{(}\PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{)} \PY{k}{returns} \PY{p}{(}\PY{n}{sol}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,}
 \PY{n}{profit} \PY{p}{:} \PY{k+kt}{int}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validProblem}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
  \PY{k}{ensures} \PY{n}{isSolution}\PY{p}{(}\PY{n}{sol}\PY{p}{,} \PY{n}{jobs}\PY{p}{)}
  \PY{k}{ensures} \PY{n}{isOptimalSolution}\PY{p}{(}\PY{n}{sol}\PY{p}{,} \PY{n}{jobs}\PY{p}{)}
\PY{p}{\PYZob{}}
  \PY{k+kd}{var} \PY{n}{dp} \PY{p}{:}\PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}} \PY{o}{:=} \PY{p}{[}\PY{p}{]}\PY{p}{;}
  \PY{k+kd}{var} \PY{n}{dp0} \PY{o}{:=} \PY{n}{jobs}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{.}\PY{n}{profit}\PY{p}{;}
  \PY{n}{dp} \PY{o}{:=} \PY{n}{dp} \PY{o}{+} \PY{p}{[}\PY{n}{dp0}\PY{p}{]}\PY{p}{;}
  \PY{k+kd}{var} \PY{n}{solution} \PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}} \PY{o}{:=} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{;} 
  \PY{k+kd}{var} \PY{n}{i}\PY{p}{:} \PY{k+kt}{int} \PY{o}{:=} \PY{l+m+mi}{1}\PY{p}{;}
  \PY{k+kd}{var} \PY{n}{allSol} \PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{o}{\PYZgt{}} \PY{o}{:=} \PY{p}{[}\PY{p}{]}\PY{p}{;} 
  \PY{n}{allSol} \PY{o}{:=} \PY{n}{allSol} \PY{o}{+} \PY{p}{[}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{]}\PY{p}{;}

  \PY{k}{assert} \PY{o}{|}\PY{n}{solution}\PY{o}{|} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{;}
  \PY{k}{assert} \PY{o}{|}\PY{n}{allSol}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{|} \PY{o}{==} \PY{o}{|}\PY{n}{solution}\PY{o}{|}\PY{p}{;}
  \PY{k}{assert} \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{solution}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{\PYZlt{}=} \PY{l+m+mi}{1}\PY{p}{;}

  \PY{k}{assert} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{solution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}\PY{p}{;}
  \PY{k}{assert} \PY{n}{validJob}\PY{p}{(}\PY{n}{jobs}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{p}{;} \PY{c+c1}{//profit \PYZgt{}=0}
  \PY{k}{assert} \PY{n}{isOptParSol}\PY{p}{(}\PY{n}{solution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}\PY{p}{;}

  \PY{k}{while} \PY{n}{i} \PY{o}{\PYZlt{}} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
    \PY{k}{invariant} \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{n}{i} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
    \PY{k}{decreases} \PY{o}{|}\PY{n}{jobs}\PY{o}{|} \PY{o}{\PYZhy{}} \PY{n}{i}
    \PY{k}{invariant} \PY{n}{i} \PY{o}{==} \PY{o}{|}\PY{n}{dp}\PY{o}{|}
    \PY{k}{invariant} \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{dp}\PY{o}{|} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
    \PY{k}{decreases} \PY{o}{|}\PY{n}{jobs}\PY{o}{|} \PY{o}{\PYZhy{}} \PY{o}{|}\PY{n}{dp}\PY{o}{|}
    \PY{k}{invariant} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{solution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}
    \PY{k}{invariant} \PY{o}{|}\PY{n}{solution}\PY{o}{|} \PY{o}{==} \PY{n}{i}
    \PY{k}{invariant} \PY{n}{i} \PY{o}{==} \PY{o}{|}\PY{n}{allSol}\PY{o}{|}
    \PY{k}{decreases} \PY{o}{|}\PY{n}{jobs}\PY{o}{|} \PY{o}{\PYZhy{}} \PY{o}{|}\PY{n}{allSol}\PY{o}{|}
    \PY{k}{decreases} \PY{o}{|}\PY{n}{jobs}\PY{o}{|} \PY{o}{\PYZhy{}} \PY{o}{|}\PY{n}{allSol}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{|}
    \PY{k}{invariant} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{allSol}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}
    \PY{k}{invariant} \PY{n}{HasProfit}\PY{p}{(}\PY{n}{solution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{,} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
    \PY{k}{invariant} \PY{n}{HasProfit}\PY{p}{(}\PY{n}{allSol}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0} \PY{p}{,} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
    \PY{k}{invariant} \PY{n}{OptParSolutions}\PY{p}{(}\PY{n}{allSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{dp}\PY{p}{,} \PY{n}{i}\PY{p}{)}
    \PY{k}{invariant} \PY{n}{isOptParSol}\PY{p}{(}\PY{n}{allSol}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}
    \PY{k}{invariant} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} 
     \PY{o}{\PYZam{}\PYZam{}} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)} \PY{o}{==}\PY{o}{\PYZgt{}}
      \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
    \PY{k}{invariant} \PY{n}{isOptParSol}\PY{p}{(}\PY{n}{solution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}
  \PY{p}{\PYZob{}}
    \PY{k+kd}{var} \PY{n}{maxProfit}\PY{p}{,} \PY{n}{optParSolWithI} \PY{o}{:=} 
        {MaxProfitWithJobI}\PY{p}{(}\PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{dp}\PY{p}{,} \PY{n}{allSol}\PY{p}{)}\PY{p}{;}
    
    \PY{k}{if} \PY{n}{dp}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZgt{}=} \PY{n}{maxProfit}
    \PY{p}{\PYZob{}}
      \PY{n}{solution}\PY{p}{,} \PY{n}{dp} \PY{o}{:=}
        \PY{n}{leadsToOptWithoutJobI}\PY{p}{(}\PY{n}{jobs}\PY{p}{,} \PY{n}{dp}\PY{p}{,} \PY{n}{allSol}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{maxProfit}\PY{p}{,} \PY{n}{solution}\PY{p}{)}\PY{p}{;}
      \PY{k}{assert} \PY{n}{isOptParSol}\PY{p}{(}\PY{n}{solution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{;}
    \PY{p}{\PYZcb{}}
    \PY{k}{else}
    \PY{p}{\PYZob{}}
      \PY{n}{solution}\PY{p}{,} \PY{n}{dp} \PY{o}{:=} 
        \PY{n}{leadsToOptWithJobI}\PY{p}{(}\PY{n}{jobs}\PY{p}{,} \PY{n}{dp}\PY{p}{,} \PY{n}{allSol}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{maxProfit}\PY{p}{,} \PY{n}{optParSolWithI}\PY{p}{)}\PY{p}{;}
      \PY{k}{assert} \PY{n}{isOptParSol}\PY{p}{(}\PY{n}{solution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{;}
    \PY{p}{\PYZcb{}}
    \PY{n}{allSol} \PY{o}{:=} \PY{n}{allSol} \PY{o}{+} \PY{p}{[}\PY{n}{solution}\PY{p}{]}\PY{p}{;} 
    \PY{n}{i} \PY{o}{:=} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{;}
  \PY{p}{\PYZcb{}}

  \PY{n}{sol} \PY{o}{:=} \PY{n}{solution}\PY{p}{;}
  \PY{n}{profit} \PY{o}{:=} \PY{n}{dp}\PY{p}{[}\PY{o}{|}\PY{n}{dp}\PY{o}{|}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{;} 
\PY{p}{\PYZcb{}}
\end{Verbatim}


\subsection{Precondiții, postcondițiilor și invarianți}
Metodele și funcțiile Dafny sunt adnotate cu precondiții, postcondiții, invarianți și afirmații (assert-uri), iar verificatorul generează condiții de verificare care sunt trimise unui solver SMT care verifică
dacă acestea sunt valide \citep{dafny-reference-manual}.
\textbf{Precondițiile} reprezintă condiții care trebuie sa fie îndeplinite la intrarea într-o metodă sau funcție. \textbf{Postcondițiile} reprezinta condiții care trebuie sa fie îndeplinite la ieșirea dintr-o metodă sau funcție.
\textbf{Invarianții} reprezintă condiții care trebuie să fie îndeplinite la intrarea în bucla, în timpul buclei și la ieșirea din aceasta. În cazul problemei de selecție a activităților avem o singură precondiție care trebuie sa fie îndeplinită,  precondiția \texttt{validProblem(jobs: seq<Job>)}. Secvența de activități primită trebuie să respecte următoarea precondiție: 
\texttt{validProblem(jobs)}. Asta înseamnă să conțină doar activități valide, distincte și sortate după timpul de încheiere. 

\begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{method} \PY{n+nf}{WeightedJobScheduling}\PY{p}{(}\PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{)} \PY{k}{returns}
 \PY{p}{(}\PY{n}{sol}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{profit} \PY{p}{:} \PY{k+kt}{int}\PY{p}{)}
     \PY{k}{requires} \PY{n}{validProblem}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
     \PY{k}{ensures} \PY{n}{isSolution}\PY{p}{(}\PY{n}{sol}\PY{p}{,} \PY{n}{jobs}\PY{p}{)}
     \PY{k}{ensures} \PY{n}{isOptimalSolution}\PY{p}{(}\PY{n}{sol}\PY{p}{,} \PY{n}{jobs}\PY{p}{)}
\end{Verbatim}

\begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
 \PY{k+kd}{predicate} \PY{n+nf}{validProblem}\PY{p}{(}\PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{)}
\PY{p}{\PYZob{}}
  \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{jobs}\PY{o}{|} \PY{o}{\PYZam{}\PYZam{}} \PY{n}{validJobsSeq}\PY{p}{(}\PY{n}{jobs}\PY{p}{)} \PY{o}{\PYZam{}\PYZam{}} \PY{n}{sortedByActEnd}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
   \PY{o}{\PYZam{}\PYZam{}} \PY{n}{distinctJobsSeq}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
\PY{p}{\PYZcb{}}
\end{Verbatim}

La final, când algoritmul se termină, soluția returnată trebuie să îndeplinească următoarele postcondiții:
\begin{itemize}
    \item \texttt{isSolution(solution: seq$<$int$>$, jobs: seq$<$Job$>$)}
    
    \item \texttt{isOptimalSolution(solution: seq$<$int$>$, jobs: seq$<$Job$>$)}
\end{itemize}despre care ofer mai multe detalii în capitolul \nameref{subsec:datedeiesire}.\\


La fiecare iterație a algoritmului, următoarele proprietăți sunt invarianți:
\begin{Verbatim}[commandchars=\\\{\},fontsize=\footnotesize]
\PY{k}{while} \PY{n}{i} \PY{o}{\PYZlt{}} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
    \PY{k}{invariant} \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{n}{i} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
    \PY{k}{decreases} \PY{o}{|}\PY{n}{jobs}\PY{o}{|} \PY{o}{\PYZhy{}} \PY{n}{i}
    \PY{k}{invariant} \PY{n}{i} \PY{o}{==} \PY{o}{|}\PY{n}{dp}\PY{o}{|}
    \PY{k}{invariant} \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{dp}\PY{o}{|} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
    \PY{k}{decreases} \PY{o}{|}\PY{n}{jobs}\PY{o}{|} \PY{o}{\PYZhy{}} \PY{o}{|}\PY{n}{dp}\PY{o}{|}
    \PY{k}{invariant} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{solution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}
    \PY{k}{invariant} \PY{o}{|}\PY{n}{solution}\PY{o}{|} \PY{o}{==} \PY{n}{i}
    \PY{k}{invariant} \PY{n}{i} \PY{o}{==} \PY{o}{|}\PY{n}{allSol}\PY{o}{|}
    \PY{k}{decreases} \PY{o}{|}\PY{n}{jobs}\PY{o}{|} \PY{o}{\PYZhy{}} \PY{o}{|}\PY{n}{allSol}\PY{o}{|}
    \PY{k}{decreases} \PY{o}{|}\PY{n}{jobs}\PY{o}{|} \PY{o}{\PYZhy{}} \PY{o}{|}\PY{n}{allSol}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{|}
    \PY{k}{invariant} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{allSol}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}
    \PY{k}{invariant} \PY{n}{HasProfit}\PY{p}{(}\PY{n}{solution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{,} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
    \PY{k}{invariant} \PY{n}{HasProfit}\PY{p}{(}\PY{n}{allSol}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0} \PY{p}{,} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
    \PY{k}{invariant} \PY{n}{allSol}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]} \PY{o}{==} \PY{n}{solution}
    \PY{k}{invariant} \PY{n}{OptParSolutions}\PY{p}{(}\PY{n}{allSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{dp}\PY{p}{,} \PY{n}{i}\PY{p}{)}
    \PY{k}{invariant} \PY{n}{isOptParSol}\PY{p}{(}\PY{n}{allSol}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}
    \PY{k}{invariant} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} 
     \PY{o}{\PYZam{}\PYZam{}} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)} \PY{o}{==}\PY{o}{\PYZgt{}}
      \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
    \PY{k}{invariant} \PY{k}{forall} \PY{n}{i} \PY{p}{::} \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{i} \PY{o}{\PYZlt{}} \PY{o}{|}\PY{n}{dp}\PY{o}{|} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{dp}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{\PYZgt{}=} \PY{l+m+mi}{0}
    \PY{k}{invariant} \PY{n}{isOptParSol}\PY{p}{(}\PY{n}{solution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}
\end{Verbatim}

Un invariant foarte important este:
\begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k}{invariant} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i}
  \PY{o}{\PYZam{}\PYZam{}} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)} \PY{o}{==}\PY{o}{\PYZgt{}} 
  \PY{n}{hasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
\end{Verbatim}
deoarece cu ajutorul lui ne asigurăm că la fiecare pas variabila \texttt{dp} reține profitul optim. 

La fel de importante sunt și:
\begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k}{invariant} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{solution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}
\PY{k}{invariant} \PY{n}{isOptParSol}\PY{p}{(}\PY{n}{solution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}
\end{Verbatim}
care ne asigură că variabila \texttt{solution} reține la fiecare pas o soluție parțială optimă. \\

\section{Detalii de implementare}

Metoda care îmi generează soluția parțială optimă ce conține activitatea \texttt{i}, este \\\texttt{MaxProfitWithJobI}. În Dafny, metodele sunt subrutine care pot fi executate în timpul execuției și pot avea efecte secundare, cum ar fi modificarea obiectelor din heap \citep{dafny-reference-manual}.
Această metodă primește ca parametri: 
\begin{enumerate}
    \item \texttt{jobs} : secvența de activități (problema);
    \item \texttt{i} : poziția (din secvența de activități primită ca date de intrare) pe care se află activitatea cu care vrem să formăm o soluție parțială optimă;  
    \item \texttt{dp} : secvența cu profiturile optime obținute la pașii anteriori;
    \item \texttt{allSol}: secvența cu soluțiile parțiale optime obținute la pașii anteriori.
\end{enumerate}
Și returnează:
\begin{enumerate}
    \item \texttt{maxProfit}: profitul pentru soluția parțială optimă ce conține activitatea de pe poziția i din secvența de activități primită ca date de intrare;
    \item \texttt{optParSolWithI}: soluția parțială optimă ce conține activitatea de pe poziția i.
\end{enumerate}
\begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{method} \PY{n+nf}{MaxProfitWithJobI}\PY{p}{(}\PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq} \PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{i}\PY{p}{:} \PY{k+kt}{int}\PY{p}{,} \PY{n}{dp}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,}
 \PY{n}{allSol} \PY{p}{:}\PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{o}{\PYZgt{}}\PY{p}{)} \PY{k}{returns} \PY{p}{(}\PY{n}{maxProfit}\PY{p}{:}\PY{k+kt}{int}\PY{p}{,} \PY{n}{optParSolWithI}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validProblem}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
  \PY{k}{requires} \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{n}{i} \PY{o}{\PYZlt{}} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
  \PY{k}{requires} \PY{o}{|}\PY{n}{allSol}\PY{o}{|} \PY{o}{==} \PY{n}{i}
  \PY{k}{requires} \PY{o}{|}\PY{n}{dp}\PY{o}{|} \PY{o}{==} \PY{n}{i}
  \PY{k}{requires} \PY{n}{OptParSolutions}\PY{p}{(}\PY{n}{allSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{dp}\PY{p}{,} \PY{n}{i}\PY{p}{)}
  \PY{k}{ensures} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{optParSolWithI}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
  \PY{k}{ensures} \PY{n}{maxProfit} \PY{o}{==} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{optParSolWithI}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
  \PY{k}{ensures} \PY{n}{partialSolutionWithJobI}\PY{p}{(}\PY{n}{optParSolWithI}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}
  \PY{k}{ensures} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1} \PY{o}{\PYZam{}\PYZam{}} 
    \PY{n}{partialSolutionWithJobI}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)} \PY{o}{==}\PY{o}{\PYZgt{}}
        \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{maxProfit}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
\PY{p}{\PYZob{}}

  \PY{k+kd}{var} \PY{n}{max\PYZus{}profit} \PY{o}{:=} \PY{l+m+mi}{0}\PY{p}{;}
  \PY{k+kd}{var} \PY{n}{partialSolutionPrefix} \PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}} \PY{o}{:=} \PY{p}{[}\PY{p}{]}\PY{p}{;}
  \PY{k+kd}{var} \PY{n}{partialSolution} \PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}} \PY{o}{:=} \PY{p}{[}\PY{p}{]}\PY{p}{;}
  \PY{k+kd}{var} \PY{n}{j} \PY{o}{:=} \PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{;}
  \PY{k+kd}{var} \PY{n}{length} \PY{o}{:=} \PY{l+m+mi}{0}\PY{p}{;}

  \PY{k}{while} \PY{n}{j} \PY{o}{\PYZgt{}=} \PY{l+m+mi}{0} \PY{o}{\PYZam{}\PYZam{}} \PY{n}{jobs}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{.}\PY{n}{jobEnd} \PY{o}{\PYZgt{}} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{.}\PY{n}{jobStart} 
    \PY{k}{invariant} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{n}{j} \PY{o}{\PYZlt{}} \PY{n}{i}
    \PY{k}{invariant} \PY{k}{forall} \PY{n}{k} \PY{p}{::} \PY{n}{j} \PY{o}{\PYZlt{}} \PY{n}{k} \PY{o}{\PYZlt{}} \PY{n}{i} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{jobs}\PY{p}{[}\PY{n}{k}\PY{p}{]}\PY{p}{.}\PY{n}{jobEnd} \PY{o}{\PYZgt{}} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{.}\PY{n}{jobStart} 
    \PY{k}{invariant} \PY{k}{forall} \PY{n}{k} \PY{p}{::} \PY{n}{j} \PY{o}{\PYZlt{}} \PY{n}{k} \PY{o}{\PYZlt{}} \PY{n}{i} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{validJob}\PY{p}{(}\PY{n}{jobs}\PY{p}{[}\PY{n}{k}\PY{p}{]}\PY{p}{)}
    \PY{k}{invariant} \PY{k}{forall} \PY{n}{k} \PY{p}{::} \PY{n}{j} \PY{o}{\PYZlt{}} \PY{n}{k} \PY{o}{\PYZlt{}} \PY{n}{i} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{JobComparator}\PY{p}{(}\PY{n}{jobs}\PY{p}{[}\PY{n}{k}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}
    \PY{k}{invariant} \PY{k}{forall} \PY{n}{k} \PY{p}{::} \PY{n}{j} \PY{o}{\PYZlt{}} \PY{n}{k} \PY{o}{\PYZlt{}} \PY{n}{i} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{jobs}\PY{p}{[}\PY{n}{k}\PY{p}{]}\PY{p}{.}\PY{n}{jobEnd} \PY{o}{\PYZgt{}} \PY{n}{jobs}\PY{p}{[}\PY{n}{k}\PY{p}{]}\PY{p}{.}\PY{n}{jobStart} 
    \PY{k}{invariant} \PY{k}{forall} \PY{n}{k} \PY{p}{::} \PY{n}{j} \PY{o}{\PYZlt{}} \PY{n}{k} \PY{o}{\PYZlt{}} \PY{n}{i} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{overlappingJobs}\PY{p}{(}\PY{n}{jobs}\PY{p}{[}\PY{n}{k}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}
  \PY{p}{\PYZob{}}
    \PY{n}{j} \PY{o}{:=} \PY{n}{j} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{;}
  \PY{p}{\PYZcb{}}

  \PY{k}{assert}  \PY{n}{j} \PY{o}{!=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{err}{!}\PY{n}{overlappingJobs}\PY{p}{(}\PY{n}{jobs}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{p}{;}

  \PY{k}{if} \PY{n}{j} \PY{o}{\PYZgt{}=} \PY{l+m+mi}{0} 
  \PY{p}{\PYZob{}}
    \PY{n}{max\PYZus{}profit}\PY{p}{,} \PY{n}{partialSolution}\PY{p}{,} \PY{n}{length} \PY{o}{:=}
     \PY{n}{OptParSolWhenNonOverlapJob}\PY{p}{(}\PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{dp}\PY{p}{,} \PY{n}{allSol}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{;}
  \PY{p}{\PYZcb{}}
  \PY{k}{else}
  \PY{p}{\PYZob{}}
    \PY{n}{max\PYZus{}profit}\PY{p}{,} \PY{n}{partialSolution}\PY{p}{,} \PY{n}{length} \PY{o}{:=}
     \PY{n}{OptParSolWhenOverlapJob}\PY{p}{(}\PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{dp}\PY{p}{)}\PY{p}{;}
  \PY{p}{\PYZcb{}}
  \PY{k}{assert} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSolution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{length}\PY{p}{)}\PY{p}{;}
  \PY{k}{assert} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1} 
    \PY{o}{\PYZam{}\PYZam{}} \PY{n}{partialSolutionWithJobI}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}
        \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{max\PYZus{}profit}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)} \PY{p}{;}
  \PY{n}{maxProfit} \PY{o}{:=} \PY{n}{max\PYZus{}profit}\PY{p}{;}
  \PY{n}{optParSolWithI} \PY{o}{:=} \PY{n}{partialSolution}\PY{p}{;}
\PY{p}{\PYZcb{}}
\end{Verbatim}

Iată cum funcționează algoritmul:
\begin{enumerate}
    \item \textbf{Date de intrare}: primim ca date de intrare variabila \texttt{jobs} care reprezintă o secvență de activități caracterizate prin timp de început, timp de încheiere și profit,  distincte (diferite prin cel puțin un timp), sortate după timpul de încheiere.
    \item \textbf{Programare dinamică}: \\
    La fiecare iterație stocam soluțiile optime ale subproblemelor și profiturile acestora.
    \begin{itemize}
        \item variabila \texttt{solution}, care reprezintă soluția parțială optimă obținută la fiecare pas, respectiv soluția optimă finală 
        \item variabila \texttt{dp}, care va conține profiturile optime obținute la fiecare iterație
        \item  variabila \texttt{allSol} care va conține toate soluțiile parțiale optime obținute la fiecare pas
    \end{itemize} 
    \item \textbf{Iterații}: 
    \begin{itemize}
        \item \textbf{La prima iterație} \texttt{solution = [1]} , \texttt{dp = jobs[1].profit} , \texttt{allSol = [[1]]} 
        \item \textbf{Selectăm activitatea de pe poziția \texttt{i}}, unde \texttt{i = 1... $|$jobs$|$ - 1}, în ordinea în care au fost declarate în secvența de intrare
        \item \textbf{Formăm soluția parțială optimă ce conține activitatea de pe poziția \texttt{i}: }
        \begin{itemize}
            \item \textbf{profitul} pentru soluția parțială optimă cu activitatea \texttt{i} are valoarea inițială \\\texttt{jobs[i].profit}
            \item \textbf{cautăm o activitate \texttt{j}}, unde \texttt{0 $<$$=$ j $<$ i}, care nu se suprapune cu activitatea \texttt{i}, adică \texttt{jobs[j].jobEnd $<$$=$ jobs[i].jobStart }
            \item \textbf{dacă \texttt{j $>$$=$ 0}} atunci soluția parțială optimă cu activitatea de pe poziția i va fi formata din 
            \texttt{allSol[j]+ 0...0 + 1}, unde:
            \begin{itemize}
                \item \texttt{allSol[j]} conține soluția parțială optimă cu activitățile de pana la poziția j inclusiv
                \item 0-urile \textbf{dacă există}, activitățile dintre \texttt{j} și \texttt{i} care se suprapun cu activitatea de pe poziția \texttt{i} 
                \item 1 înseamnă că activitatea \texttt{i} este selectată
            \end{itemize}
            iar \textbf{profitul} (\texttt{maxProfit}) pentru soluția parțială optimă ce conține activitatea \texttt{i} devine \texttt{dp[j] + jobs[i].profit}
             \item \textbf{dacă \texttt{j $=$$=$ -1}} atunci soluția parțială optimă cu activitatea de pe poziția i va fi formată din 
             \texttt{0...0 + 1}, unde: 
            \begin{itemize}
                \item 0-urile reprezinta, activitățile din fața activității i care se suprapun cu aceasta. 
                \item 1- înseamnă că activitatea de pe poziția i a fost selectată 
            \end{itemize}
            iar \textbf{profitul}(\texttt{maxProfit}) rămâne egal cu \textbf{jobs[i].profit}
        \end{itemize}
    \item \textbf{Comparăm} profitul soluției parțiale optime (\texttt{maxProfit}) ce conține activitatea de pe poziția \texttt{i} cu profitul care s-ar obține fără activitatea curentă (\texttt{dp[i-1]}) și \textbf{actualizăm} valoarea variabilelor \texttt{dp} și \texttt{solution}
    \begin{itemize}
        \item dacă \texttt{dp[i-1]} $>$= \textbf{profitul} soluției parțiale optime cu activitatea i \\(\texttt{maxProfit}), atunci \texttt{dp[i] = dp[i-1]} și \texttt{solution = solution + [0]}
        \item dacă \texttt{dp[i-1] $<$} \textbf{profitul} soluției parțiale optime cu activitatea i \\(\texttt{maxProfit}), atunci \texttt{dp[i] = maxProfit} (profitul soluției parțiale optime cu activitatea i) și \texttt{solution} = soluția parțială optimă ce conține activitatea i \\(\texttt{optParSolWithI}) 
    \end{itemize}
    \item \textbf{Actualizăm valoarea variabilei \texttt{allSol}} care reține soluțiile parțiale optime obținute la fiecare iterație, \texttt{allSol = allSol + [solution]} 
    \end{itemize}
    \item \textbf{Datele de ieșire ale problemei} sunt  reprezentate de soluția optimă \texttt{sol := solution} și de profitul maxim, \texttt{profit} $=$ \texttt{dp[$|$dp$|$ - 1]}  
\end{enumerate}

\section{Date de ieșire și predicate specifice }
\label{subsec:datedeiesire}
Algoritmul care rezolvă problema de selecție a activităților cu profit maxim prezentat mai sus are următoarele date de ieșire:
\begin{itemize}
    \item \texttt{sol} de tipul {\textit{seq$<$int$>$}} : reprezintă soluția optimă finală pentru secvența de activități primită 
    \item \texttt{profit} de tipul \textit{int} : reprezintă profitul maxim al soluției optime finale
\end{itemize}

Predicatele folosite la validarea datele de ieșire sunt:
\begin{itemize}
    \item Predicatul \texttt{isSolution(solution: seq$<$int$>$, jobs: seq$<$Job$>$)} verifică dacă o secvență este soluție parțială și o soluție pentru secvența de activități primită ca date de intrare.
    \begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{predicate} \PY{n+nf}{isSolution}\PY{p}{(}\PY{n}{solution}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq} \PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validJobsSeq}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
\PY{p}{\PYZob{}}
  \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{solution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}\PY{p}{)}
\PY{p}{\PYZcb{}}
\end{Verbatim}
    \item Predicatul \texttt{isOptimalSolution(solution: seq$<$int$>$, jobs: seq$<$Job$>$)} care verifică dacă o secvență este o soluție optimă.\\
    O soluție este optimă dacă pentru aceeași problemă, nu există o altă soluție care să aibă un profit mai bun.
    \begin{footnotesize}
    \begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{ghost} \PY{k+kd}{predicate} \PY{n+nf}{isOptimalSolution}\PY{p}{(}\PY{n}{solution}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validJobsSeq}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
  \PY{k}{requires} \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
  \PY{k}{requires} \PY{o}{|}\PY{n}{solution}\PY{o}{|} \PY{o}{==} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
\PY{p}{\PYZob{}}
  \PY{n}{isSolution}\PY{p}{(}\PY{n}{solution}\PY{p}{,} \PY{n}{jobs}\PY{p}{)} \PY{o}{\PYZam{}\PYZam{}}
  \PY{k}{forall} \PY{n}{otherSol} \PY{p}{::} \PY{n}{isSolution}\PY{p}{(}\PY{n}{otherSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{)} \PY{o}{==}\PY{o}{\PYZgt{}} 
   \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{solution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)} \PY{o}{\PYZgt{}=} 
    \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{otherSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{footnotesize}
\end{itemize} 


Variabila de ieșire, \texttt{sol}, este reprezentată printr-un vector caracteristic al secvenței de activități primită ca date de intrare. Acest vector conține doar valori de 0 și 1, unde 0 înseamnă că o activitate nu a fost selectată, în timp ce 1 indică faptul că activitatea respectivă a fost selectată.

\section{Leme importante în demonstrarea corectitudinii}
Unul din punctele complexe în dezvoltarea codului de verificare pentru problema de selecție a activităților a fost atunci când a trebuit să recurg la leme pentru a demonstra anumite proprietăți. Lemele reprezintă blocuri de instrucțiuni care au ca scop demonstrarea unor teoreme pe care Dafny nu reușește să le demonstreze de unul singur.

Am folosit lema \texttt{OtherSolhasLessProfThenMaxProfit2} pentru a demonstra că orice \textbf{soluție parțială}:
\begin{enumerate}
    \item care \textbf{conține activitatea de pe poziția \texttt{i}}
    \item pentru care activitățile de pe pozițiile \texttt{j + 1, ..., i - 1} \textbf{se suprapune cu activitatea \texttt{i}}, unde \texttt{0 $<=$ j $<$ i}
    \item activitatea de pe poziția \texttt{j} \textbf{nu se suprapune} cu activitatea de pe poziția \texttt{i} 
\end{enumerate}
are un \textbf{profit mai mic sau egal} decât cel al soluției parțiale care îndeplinește aceleași proprietăți menționate mai sus, și pentru care \texttt{substructura [0..j] este optimă}. 

\begin{Verbatim}[commandchars=\\\{\},fontsize=\footnotesize]
\PY{k+kd}{lemma} \PY{n+nf}{OtherSolHasLessProfThenMaxProfit2}\PY{p}{(}\PY{n}{partialSol}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{jobs} \PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{,}
 \PY{n}{i}\PY{p}{:} \PY{k+kt}{int}\PY{p}{,} \PY{n}{j} \PY{p}{:} \PY{k+kt}{int}\PY{p}{,} \PY{n}{max\PYZus{}profit} \PY{p}{:} \PY{k+kt}{int}\PY{p}{,} \PY{n}{allSol} \PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{dp}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validJobsSeq}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
  \PY{k}{requires} \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
  \PY{k}{requires} \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{j} \PY{o}{\PYZlt{}} \PY{n}{i} \PY{o}{\PYZlt{}} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
  \PY{k}{requires} \PY{o}{|}\PY{n}{allSol}\PY{o}{|} \PY{o}{==} \PY{o}{|}\PY{n}{dp}\PY{o}{|} \PY{o}{==} \PY{n}{i} 
  \PY{k}{requires} \PY{n}{OptParSolutions}\PY{p}{(}\PY{n}{allSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{dp}\PY{p}{,} \PY{n}{i}\PY{p}{)}
  \PY{k}{requires} \PY{n}{isOptParSol}\PY{p}{(}\PY{n}{allSol}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{j} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
  \PY{k}{requires} \PY{n}{max\PYZus{}profit} \PY{o}{==} \PY{n}{dp}\PY{p}{[}\PY{n}{j}\PY{p}{]} \PY{o}{+} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{.}\PY{n}{profit} 
  \PY{k}{requires} \PY{k}{forall} \PY{n}{k} \PY{p}{::} \PY{n}{j} \PY{o}{\PYZlt{}} \PY{n}{k} \PY{o}{\PYZlt{}} \PY{n}{i} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{overlappingJobs}\PY{p}{(}\PY{n}{jobs}\PY{p}{[}\PY{n}{k}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}
  \PY{k}{requires} \PY{err}{!}\PY{n}{overlappingJobs}\PY{p}{(}\PY{n}{jobs}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}
  \PY{k}{requires} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}
  \PY{k}{requires} \PY{n}{partialSolutionWithJobI}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}
  \PY{k}{requires} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)} \PY{o}{==} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{.}\PY{n}{profit}\PY{p}{;}
  \PY{k}{requires} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
  \PY{k}{requires} \PY{k}{forall} \PY{n}{k} \PY{p}{::} \PY{n}{j} \PY{o}{\PYZlt{}} \PY{n}{k} \PY{o}{\PYZlt{}} \PY{n}{i} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{partialSol}\PY{p}{[}\PY{n}{k}\PY{p}{]} \PY{o}{==} \PY{l+m+mi}{0}
  \PY{k}{ensures} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{max\PYZus{}profit}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
\PY{p}{\PYZob{}}
  \PY{k+kd}{var} \PY{n}{k} \PY{p}{:} \PY{k+kt}{int} \PY{o}{:=} \PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{;}
  \PY{k}{assert} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{;}
  \PY{k}{assert} \PY{n}{j} \PY{o}{\PYZlt{}=} \PY{n}{k} \PY{o}{\PYZlt{}} \PY{n}{i}\PY{p}{;}
  \PY{c+c1}{//assert !exists k\PYZsq{} :: k \PYZlt{} k\PYZsq{} \PYZlt{} i;}
  \PY{k}{assert} \PY{k}{forall} \PY{n}{k}\PY{l+s+s1}{\PYZsq{} :: k \PYZlt{} k\PYZsq{}} \PY{o}{\PYZlt{}} \PY{n}{i} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{partialSol}\PY{p}{[}\PY{n}{k}\PY{l+s+s1}{\PYZsq{}] == 0; }
\PY{l+s+s1}{  assert PartialSolProfit(partialSol, jobs, i) == jobs[i].profit;}
\PY{l+s+s1}{  ComputeProfitWhenOnly0BetweenJI(partialSol, jobs, i, j);}
\PY{l+s+s1}{  assert PartialSolProfit(partialSol, jobs, j + 1) == jobs[i].profit;}
\PY{l+s+s1}{  if !HasLessProf(partialSol, jobs, max\PYZus{}profit, 0)}
\PY{l+s+s1}{  \PYZob{}}
\PY{l+s+s1}{    var profit\PYZsq{}} \PY{o}{:=} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
    \PY{k}{assert} \PY{n}{max\PYZus{}profit} \PY{o}{==} \PY{n}{dp}\PY{p}{[}\PY{n}{j}\PY{p}{]} \PY{o}{+} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{.}\PY{n}{profit}\PY{p}{;}

    \PY{k}{assert} \PY{n}{HasMoreProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{max\PYZus{}profit}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
    \PY{k}{assert} \PY{err}{!}\PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{max\PYZus{}profit}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}

    \PY{k}{assert} \PY{n}{partialSol}\PY{p}{[}\PY{p}{..}\PY{n}{j}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{+} \PY{n}{partialSol}\PY{p}{[}\PY{n}{j}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{..}\PY{p}{]} \PY{o}{==} \PY{n}{partialSol}\PY{p}{;}
    
    \PY{n}{SplitSequenceProfitEquality}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{,} \PY{n}{j} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{;}
    \PY{n}{EqOfProfitFuncFromIndToEnd}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
    \PY{n}{EqOfProfFuncUntilIndex}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{,} \PY{n}{j} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{;}
    \PY{n}{EqOfProfitFuncFromIndToEnd}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{j} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{;}

    \PY{k}{assert} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{[}\PY{p}{..}\PY{n}{j} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)} \PY{o}{+}
     \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{j} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{==}
      \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
    \PY{k}{assert} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{j} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{==} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{.}\PY{n}{profit}\PY{p}{;}

    \PY{k+kd}{var} \PY{n}{partialSol}\PY{l+s+s1}{\PYZsq{} :seq\PYZlt{}int\PYZgt{} := partialSol[..j + 1];}
\PY{l+s+s1}{    assert isPartialSol(partialSol\PYZsq{}}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{j} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{;}
    \PY{k+kd}{var} \PY{n}{profit} \PY{o}{:=} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSol}\PY{l+s+s1}{\PYZsq{}, jobs, 0);}

\PY{l+s+s1}{    assert |partialSol\PYZsq{}}\PY{o}{|} \PY{o}{==} \PY{n}{j} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{;}
    \PY{k}{assert} \PY{n}{profit} \PY{o}{+} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{.}\PY{n}{profit} \PY{o}{==} \PY{n}{profit}\PY{l+s+s1}{\PYZsq{}; }
\PY{l+s+s1}{    assert profit + jobs[i].profit \PYZgt{} max\PYZus{}profit; }
\PY{l+s+s1}{    assert profit \PYZgt{} max\PYZus{}profit \PYZhy{} jobs[i].profit;}
\PY{l+s+s1}{    assert profit \PYZgt{} dp[j];}
\PY{l+s+s1}{    HasMoreProfThanOptParSol(allSol[j], jobs, partialSol\PYZsq{}}\PY{p}{)}\PY{p}{;}
    \PY{k}{assert} \PY{err}{!}\PY{n}{isOptParSol}\PY{p}{(}\PY{n}{allSol}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{j} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{;} \PY{c+c1}{//contradictie}
    \PY{c+c1}{//assume false;}
    \PY{k}{assert} \PY{k+kc}{false}\PY{p}{;}
  \PY{p}{\PYZcb{}}
  \PY{k}{assert} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{max\PYZus{}profit}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
\PY{p}{\PYZcb{}}
\end{Verbatim}

Am folosit această lemă în cadrul metodei \textbf{OptParSolWhenNonOverlapJob} pe care o apelez în metoda \textbf{MaxProfitWithJobI}  pe ramura cu \texttt{j $>=$ 0}, atunci când găsim o activitate pe o poziție \texttt{j} , unde \texttt{j < i} în fața activității de pe poziția i, care nu se suprapune cu aceasta.
\begin{footnotesize}
\begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{method}  \PY{n+nf}{OptParSolWhenNonOverlapJob}\PY{p}{(}\PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq} \PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{i}\PY{p}{:} \PY{k+kt}{int}\PY{p}{,} \PY{n}{dp}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,}
 \PY{n}{allSol} \PY{p}{:}\PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{j} \PY{p}{:} \PY{k+kt}{int}\PY{p}{)}
 \PY{k}{returns} \PY{p}{(}\PY{n}{maxProfit}\PY{p}{:}\PY{k+kt}{int}\PY{p}{,} \PY{n}{partialSolution}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{length}\PY{p}{:} \PY{k+kt}{int}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validProblem}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
  \PY{k}{requires} \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{j} \PY{o}{\PYZlt{}} \PY{n}{i} \PY{o}{\PYZlt{}} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
  \PY{k}{requires} \PY{o}{|}\PY{n}{allSol}\PY{o}{|} \PY{o}{==} \PY{n}{i}
  \PY{k}{requires} \PY{o}{|}\PY{n}{dp}\PY{o}{|} \PY{o}{==} \PY{n}{i}
  \PY{k}{requires} \PY{n}{OptParSolutions}\PY{p}{(}\PY{n}{allSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{dp}\PY{p}{,} \PY{n}{i}\PY{p}{)}
  \PY{k}{requires} \PY{err}{!}\PY{n}{overlappingJobs}\PY{p}{(}\PY{n}{jobs}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{p}{;}
  \PY{k}{requires} \PY{n}{jobs}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{.}\PY{n}{jobEnd} \PY{o}{\PYZlt{}=} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{.}\PY{n}{jobStart}
  \PY{k}{requires} \PY{k}{forall} \PY{n}{k} \PY{p}{::} \PY{n}{j} \PY{o}{\PYZlt{}} \PY{n}{k} \PY{o}{\PYZlt{}} \PY{n}{i} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{overlappingJobs}\PY{p}{(}\PY{n}{jobs}\PY{p}{[}\PY{n}{k}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)} 
  \PY{k}{requires} \PY{err}{!}\PY{n}{overlappingJobs}\PY{p}{(}\PY{n}{jobs}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{p}{;}
  \PY{k}{ensures} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSolution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
  \PY{k}{ensures} \PY{n}{partialSolutionWithJobI}\PY{p}{(}\PY{n}{partialSolution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}
  \PY{k}{ensures} \PY{n}{maxProfit} \PY{o}{==} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSolution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
  \PY{k}{ensures} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1} \PY{o}{\PYZam{}\PYZam{}}
   \PY{n}{partialSolutionWithJobI}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)} \PY{o}{==}\PY{o}{\PYZgt{}}
   \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{maxProfit}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
  \PY{k}{ensures} \PY{n}{length} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{;}
\PY{p}{\PYZob{}}
  \PY{k+kd}{var} \PY{n}{partialSolutionPrefix} \PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}} \PY{o}{:=} \PY{p}{[}\PY{p}{]}\PY{p}{;}
  \PY{k+kd}{var} \PY{n}{max\PYZus{}profit} \PY{p}{:} \PY{k+kt}{int} \PY{o}{:=} \PY{l+m+mi}{0} \PY{p}{;}
  \PY{n}{length} \PY{o}{:=} \PY{l+m+mi}{0}\PY{p}{;}

  \PY{n}{partialSolutionPrefix} \PY{o}{:=} \PY{n}{allSol}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{;}
  \PY{n}{length} \PY{o}{:=} \PY{n}{length} \PY{o}{+} \PY{o}{|}\PY{n}{allSol}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{|}\PY{p}{;}

  \PY{k}{assert} \PY{k}{forall} \PY{n}{i} \PY{p}{::} \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{i} \PY{o}{\PYZlt{}=} \PY{n}{length} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1} \PY{o}{==}\PY{o}{\PYZgt{}}
   \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{partialSolutionPrefix}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{\PYZlt{}=} \PY{l+m+mi}{1}\PY{p}{;} 
  \PY{k}{assert} \PY{n}{hasNoOverlappingJobs}\PY{p}{(}\PY{n}{partialSolutionPrefix}\PY{p}{,} \PY{n}{jobs}\PY{p}{)}\PY{p}{;}

  \PY{n}{max\PYZus{}profit} \PY{o}{:=} \PY{n}{max\PYZus{}profit} \PY{o}{+} \PY{n}{dp}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{;}

  \PY{k+kd}{var} \PY{n}{nr\PYZus{}of\PYZus{}zeros} \PY{o}{:=} \PY{n}{i} \PY{o}{\PYZhy{}} \PY{o}{|}\PY{n}{allSol}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{|}\PY{p}{;} 

  \PY{k}{while} \PY{n}{nr\PYZus{}of\PYZus{}zeros} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}
    \PY{k}{decreases} \PY{n}{nr\PYZus{}of\PYZus{}zeros}
    \PY{k}{invariant} \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{nr\PYZus{}of\PYZus{}zeros} \PY{o}{\PYZlt{}=} \PY{n}{i} \PY{o}{\PYZhy{}} \PY{o}{|}\PY{n}{allSol}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{|} 
    \PY{k}{decreases} \PY{n}{i} \PY{o}{\PYZhy{}} \PY{n}{length}
    \PY{k}{invariant} \PY{o}{|}\PY{n}{allSol}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{o}{|} \PY{o}{\PYZlt{}=} \PY{n}{length} \PY{o}{\PYZlt{}=} \PY{n}{i} 
    \PY{k}{invariant} \PY{o}{|}\PY{n}{partialSolutionPrefix}\PY{o}{|} \PY{o}{==} \PY{n}{length}
    \PY{k}{invariant} \PY{k}{forall} \PY{n}{k} \PY{p}{::} \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{k} \PY{o}{\PYZlt{}=} \PY{n}{length} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1} \PY{o}{==}\PY{o}{\PYZgt{}}
     \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{partialSolutionPrefix}\PY{p}{[}\PY{n}{k}\PY{p}{]} \PY{o}{\PYZlt{}=} \PY{l+m+mi}{1}
    \PY{k}{invariant} \PY{n}{length} \PY{o}{\PYZlt{}} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}\PY{p}{;}
    \PY{k}{invariant} \PY{n}{length} \PY{o}{==} \PY{n}{i} \PY{o}{\PYZhy{}} \PY{n}{nr\PYZus{}of\PYZus{}zeros}
    \PY{k}{invariant} \PY{n}{hasNoOverlappingJobs}\PY{p}{(}\PY{n}{partialSolutionPrefix}\PY{p}{,} \PY{n}{jobs}\PY{p}{)}
    \PY{k}{invariant} \PY{k}{forall} \PY{n}{k} \PY{p}{::} \PY{n}{j} \PY{o}{\PYZlt{}} \PY{n}{k} \PY{o}{\PYZlt{}} \PY{o}{|}\PY{n}{partialSolutionPrefix}\PY{o}{|} \PY{o}{==}\PY{o}{\PYZgt{}} 
        \PY{n}{partialSolutionPrefix}\PY{p}{[}\PY{n}{k}\PY{p}{]} \PY{o}{==} \PY{l+m+mi}{0}
    \PY{k}{invariant} \PY{n}{max\PYZus{}profit} \PY{o}{==} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSolutionPrefix}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
  \PY{p}{\PYZob{}}
    \PY{n}{AssociativityOfProfitFunc}\PY{p}{(}\PY{n}{partialSolutionPrefix}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;} 
    \PY{k}{assert} \PY{n}{max\PYZus{}profit} \PY{o}{==} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSolutionPrefix}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
    \PY{n}{partialSolutionPrefix} \PY{o}{:=}  \PY{n}{partialSolutionPrefix} \PY{o}{+} \PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{;}
    \PY{k}{assert} \PY{n}{length} \PY{o}{+} \PY{n}{nr\PYZus{}of\PYZus{}zeros} \PY{o}{\PYZlt{}} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}\PY{p}{;}
    \PY{n}{length} \PY{o}{:=} \PY{n}{length} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{;}
    \PY{n}{nr\PYZus{}of\PYZus{}zeros} \PY{o}{:=} \PY{n}{nr\PYZus{}of\PYZus{}zeros} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{;}
    \PY{k}{assert} \PY{n}{max\PYZus{}profit} \PY{o}{==} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSolutionPrefix}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
  \PY{p}{\PYZcb{}}

  \PY{k}{assert} \PY{n}{length} \PY{o}{==} \PY{n}{i}\PY{p}{;}
  \PY{k}{assert} \PY{o}{|}\PY{n}{partialSolutionPrefix}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{p}{;}

  \PY{k}{assert} \PY{k}{forall} \PY{n}{k} \PY{p}{::} \PY{n}{j} \PY{o}{\PYZlt{}} \PY{n}{k} \PY{o}{\PYZlt{}} \PY{n}{i} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{partialSolutionPrefix}\PY{p}{[}\PY{n}{k}\PY{p}{]} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{;}
  \PY{k}{assert} \PY{k}{forall} \PY{n}{k} \PY{p}{::} \PY{n}{j} \PY{o}{\PYZlt{}} \PY{n}{k} \PY{o}{\PYZlt{}} \PY{n}{i} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{overlappingJobs}\PY{p}{(}\PY{n}{jobs}\PY{p}{[}\PY{n}{k}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{p}{;} 
  \PY{k}{assert} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSolutionPrefix}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}\PY{p}{;}

  \PY{k}{assert} \PY{n}{hasNoOverlappingJobs}\PY{p}{(}\PY{n}{partialSolutionPrefix} \PY{o}{+} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{)}\PY{p}{;} 

  \PY{n}{AssociativityOfProfitFunc}\PY{p}{(}\PY{n}{partialSolutionPrefix}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;} 
  \PY{n}{partialSolutionPrefix} \PY{o}{:=} \PY{n}{partialSolutionPrefix} \PY{o}{+} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{;}
  \PY{n}{length} \PY{o}{:=} \PY{n}{length} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{;}
  \PY{n}{max\PYZus{}profit} \PY{o}{:=} \PY{n}{max\PYZus{}profit} \PY{o}{+} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{.}\PY{n}{profit}\PY{p}{;}

  \PY{k}{assert} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSolutionPrefix}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{;}
  \PY{k}{assert} \PY{n}{max\PYZus{}profit} \PY{o}{==} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSolutionPrefix}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
  \PY{k}{forall} \PY{n}{partialSol} \PY{o}{|} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1} 
    \PY{o}{\PYZam{}\PYZam{}} \PY{n}{partialSolutionWithJobI}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}
    \PY{k}{ensures} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{max\PYZus{}profit}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
  \PY{p}{\PYZob{}}
   
    \PY{n}{OnlY0WhenOverlapJobs}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{;} 
    \PY{k}{assert} \PY{k}{forall} \PY{n}{k} \PY{p}{::} \PY{n}{j} \PY{o}{\PYZlt{}} \PY{n}{k} \PY{o}{\PYZlt{}} \PY{n}{i} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{partialSol}\PY{p}{[}\PY{n}{k}\PY{p}{]} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{;}
    \PY{n}{ProfitLastElem}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}\PY{p}{;}
    \PY{k}{assert} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)} \PY{o}{==} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{.}\PY{n}{profit}\PY{p}{;}
    \PY{n}{OtherSolHasLessProfThenMaxProfit2}
        \PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{j}\PY{p}{,} \PY{n}{max\PYZus{}profit}\PY{p}{,} \PY{n}{allSol}\PY{p}{,} \PY{n}{dp}\PY{p}{)}\PY{p}{;}
  \PY{p}{\PYZcb{}}
  \PY{n}{maxProfit} \PY{o}{:=} \PY{n}{max\PYZus{}profit}\PY{p}{;}
  \PY{n}{partialSolution} \PY{o}{:=} \PY{n}{partialSolutionPrefix}\PY{p}{;}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{footnotesize}

Pentru a demonstra această lemă am folosit metoda reducerii la absurd. Presupunând că ar exista o altă soluție parțiala cu aceleași proprietăți care ar avea un profit mai mare decât soluția parțială optimă obținută, am arătat că există o alta soluție parțiala de lungime \texttt{j $+$ 1} al cărei profit este mai mare decât cel al soluției parțiale optime de lungime \texttt{j $+$ 1}, ceea ce este imposibil, deoarece ar contrazice ipoteza de la care am plecat. În acest mod, am identificat și \textbf{proprietatea de substructura optimă}, care se ascunde în această lemă. 

În lema \texttt{HasMoreProfThanOptParSol} am confirmat că în cazul în care există o altă soluție parțială cu un profit mai mare decât cel al soluției optime, atunci soluția considerată optimă nu poate fi cu adevărat optimă.


\begin{Verbatim}[commandchars=\\\{\},fontsize=\footnotesize]
\PY{k+kd}{lemma} \PY{n+nf}{HasMoreProfThanOptParSol}\PY{p}{(}\PY{n}{optimalPartialSol}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{,}
 \PY{n}{partialSol}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validJobsSeq}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
  \PY{k}{requires} \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{optimalPartialSol}\PY{o}{|} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
  \PY{k}{requires} \PY{o}{|}\PY{n}{optimalPartialSol}\PY{o}{|} \PY{o}{==} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|}
  \PY{k}{requires} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|}\PY{p}{)}
  \PY{k}{requires} \PY{n}{isOptParSol}\PY{p}{(}\PY{n}{optimalPartialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{o}{|}\PY{n}{optimalPartialSol}\PY{o}{|}\PY{p}{)}
  \PY{k}{requires} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)} \PY{o}{\PYZgt{}}
   \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{optimalPartialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
  \PY{k}{ensures} \PY{err}{!}\PY{n}{isOptParSol}\PY{p}{(}\PY{n}{optimalPartialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{o}{|}\PY{n}{optimalPartialSol}\PY{o}{|}\PY{p}{)}
\PY{p}{\PYZob{}}
  \PY{k+kd}{var} \PY{n}{other\PYZus{}profit} \PY{o}{:=} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
  \PY{k+kd}{var} \PY{n}{optParSolProfit} \PY{o}{:=} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{optimalPartialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
  \PY{k}{assert} \PY{k}{forall} \PY{n}{otherSol}\PY{p}{::} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{otherSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{o}{|}\PY{n}{optimalPartialSol}\PY{o}{|}\PY{p}{)} 
   \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{otherSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{optParSolProfit}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
  \PY{k}{assert} \PY{n}{other\PYZus{}profit} \PY{o}{\PYZgt{}} \PY{n}{optParSolProfit}\PY{p}{;}
  \PY{k}{assert} \PY{err}{!}\PY{n}{isOptParSol}\PY{p}{(}\PY{n}{optimalPartialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{o}{|}\PY{n}{optimalPartialSol}\PY{o}{|}\PY{p}{)}\PY{p}{;}
\PY{p}{\PYZcb{}}
\end{Verbatim}

De asemenea, consider că și lemele pe care le-am demonstrat prin inducția au fost importante, precum \texttt{AssociativityOfProfitFunc}.

\begin{Verbatim}[commandchars=\\\{\},fontsize=\footnotesize]
\PY{k+kd}{lemma} \PY{n+nf}{AssociativityOfProfitFunc}\PY{p}{(}\PY{n}{partialSolPrefix} \PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{,}
 \PY{n}{val}\PY{p}{:} \PY{k+kt}{int}\PY{p}{,} \PY{n}{index}\PY{p}{:} \PY{k+kt}{int}\PY{p}{)}
  \PY{k}{requires} \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
  \PY{k}{requires} \PY{n}{validJobsSeq}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
  \PY{k}{requires} \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{index} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{partialSolPrefix}\PY{o}{|}
  \PY{k}{requires} \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{val} \PY{o}{\PYZlt{}=} \PY{l+m+mi}{1}
  \PY{k}{requires} \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{partialSolPrefix}\PY{o}{|} \PY{o}{\PYZlt{}} \PY{o}{|}\PY{n}{jobs}\PY{o}{|} 
  \PY{k}{decreases} \PY{o}{|}\PY{n}{partialSolPrefix}\PY{o}{|} \PY{o}{\PYZhy{}} \PY{n}{index}
  \PY{k}{ensures} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSolPrefix}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{index}\PY{p}{)} 
    \PY{o}{+} \PY{n}{val} \PY{o}{*} \PY{n}{jobs}\PY{p}{[}\PY{o}{|}\PY{n}{partialSolPrefix}\PY{o}{|}\PY{p}{]}\PY{p}{.}\PY{n}{profit} \PY{o}{==}
          \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSolPrefix} \PY{o}{+} \PY{p}{[}\PY{n}{val}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{index}\PY{p}{)}
\PY{p}{\PYZob{}}
  \PY{k}{if} \PY{o}{|}\PY{n}{partialSolPrefix}\PY{o}{|} \PY{o}{==} \PY{n}{index} \PY{p}{\PYZob{}}

  \PY{p}{\PYZcb{}}
  \PY{k}{else}
  \PY{p}{\PYZob{}}
    \PY{n}{AssociativityOfProfitFunc}\PY{p}{(}\PY{n}{partialSolPrefix} \PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{val}\PY{p}{,} \PY{n}{index} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{;}
  \PY{p}{\PYZcb{}}
\PY{p}{\PYZcb{}}
\end{Verbatim}

În cadrul acestei leme se poate observa cum am demonstrat proprietatea de asociativitate a funcției  \texttt{PartialSolutionPrefixProfit}, care îmi calculează profitul pentru o soluție parțială. Dacă adăugam un element la sfârșitul unei soluții parțiale, valoarea profitului acesteia crește cu valoarea profitului activității adăugate. 
\\

În metoda principală \texttt{WeightedJobScheduling} apelez două metode importante:
\begin{itemize}
    \item\texttt{leadsToOptWithoutJobI}. Metoda \texttt{leadsToOptWithoutJobI} returnează \\soluția parțială optimă în cazul în care soluția parțială optimă ce conține activitatea \texttt{i}
    are profitul mai mic sau egal decât \texttt{dp[i-1]}, profitul care s-ar obține fără adăugare activității \texttt{i}. Pe această ramură se consideră construirea soluției parțiale optime fără a alege activitatea de pe poziția \texttt{i}.
    \begin{Verbatim}[commandchars=\\\{\},fontsize=\footnotesize]
\PY{k+kd}{method} \PY{n+nf}{leadsToOptWithoutJobI}\PY{p}{(}\PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{dp}\PY{p}{:}\PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,} 
\PY{n}{allSol}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{i}\PY{p}{:} \PY{k+kt}{int}\PY{p}{,} \PY{n}{maxProfit}\PY{p}{:} \PY{k+kt}{int}\PY{p}{,}
 \PY{n}{optParSol}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{)} \PY{k}{returns}
 \PY{p}{(}\PY{n}{optimalPartialSolution}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{profits}\PY{p}{:}\PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validProblem}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
  \PY{k}{requires} \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{n}{i} \PY{o}{\PYZlt{}} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
  \PY{k}{requires} \PY{o}{|}\PY{n}{dp}\PY{o}{|} \PY{o}{==} \PY{o}{|}\PY{n}{allSol}\PY{o}{|} \PY{o}{==} \PY{n}{i}
  \PY{k}{requires} \PY{o}{|}\PY{n}{optParSol}\PY{o}{|} \PY{o}{==} \PY{n}{i}
  \PY{k}{requires} \PY{n}{isOptParSol}\PY{p}{(}\PY{n}{optParSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}
  \PY{k}{requires} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]} \PY{o}{==} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{optParSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
  \PY{k}{requires} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}
    \PY{o}{\PYZam{}\PYZam{}} \PY{n}{partialSolutionWithJobI}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)} 
        \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{maxProfit}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
  \PY{k}{requires} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i}  
    \PY{o}{\PYZam{}\PYZam{}} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)} 
        \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;} 
  \PY{k}{requires} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZgt{}=} \PY{n}{maxProfit}
  \PY{k}{ensures} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{optimalPartialSolution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
  \PY{k}{ensures} \PY{n}{isOptParSol}\PY{p}{(}\PY{n}{optimalPartialSolution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
  \PY{k}{ensures} \PY{n}{profits} \PY{o}{==} \PY{n}{dp} \PY{o}{+} \PY{p}{[}\PY{n}{dp}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{]}
  \PY{k}{ensures} \PY{o}{|}\PY{n}{profits}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}
  \PY{k}{ensures} \PY{n}{HasProfit}\PY{p}{(}\PY{n}{optimalPartialSolution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{,} \PY{n}{profits}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}
  \PY{k}{ensures} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}
   \PY{o}{\PYZam{}\PYZam{}} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|}\PY{p}{)}
    \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{profits}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
\PY{p}{\PYZob{}}
  \PY{k}{assert} \PY{n}{dp}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZgt{}=} \PY{n}{maxProfit}\PY{p}{;}
  \PY{n}{profits} \PY{o}{:=} \PY{n}{dp} \PY{o}{+} \PY{p}{[}\PY{n}{dp}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{]}\PY{p}{;}
  \PY{k}{assert} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]} \PY{o}{==} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{optParSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}

  \PY{n}{AssociativityOfProfitFunc}\PY{p}{(}\PY{n}{optParSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
  \PY{n}{optimalPartialSolution} \PY{o}{:=} \PY{n}{optParSol} \PY{o}{+} \PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{;}
  \PY{k}{assert} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]} \PY{o}{==} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{optimalPartialSolution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}

  \PY{k}{assert} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{optimalPartialSolution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{;}
  \PY{k}{assert} \PY{n}{partialSolutionWithoutJobI}\PY{p}{(}\PY{n}{optimalPartialSolution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}\PY{p}{;}
  \PY{n}{optimalPartialSolutionWithoutJobI}\PY{p}{(}\PY{n}{i}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{maxProfit}\PY{p}{,} \PY{n}{dp}\PY{p}{,} \PY{n}{profits}\PY{p}{)}\PY{p}{;}

  \PY{k}{assert} \PY{n}{isOptParSol}\PY{p}{(}\PY{n}{optimalPartialSolution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{;}
  \PY{k}{assert} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1} \PY{o}{\PYZam{}\PYZam{}}
   \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|}\PY{p}{)} 
        \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{profits}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
\PY{p}{\PYZcb{}}
\end{Verbatim}
Lema \texttt{optimalPartialSolutionWithoutJobI} demonstrează știind că soluția parțială optimă ce conține activitatea \texttt{i} aduce un profit mai mic decât dacă nu s-ar alege activitatea de pe poziția \texttt{i}, că fără activitatea de pe poziția \texttt{i} se obține o soluție parțială optimă pentru subproblema pe care o rezolvă.
\begin{Verbatim}[commandchars=\\\{\},fontsize=\footnotesize]
\PY{k+kd}{lemma} \PY{n+nf}{optimalPartialSolutionWithoutJobI}\PY{p}{(}\PY{n}{i}\PY{p}{:} \PY{k+kt}{int}\PY{p}{,} \PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{,}
 \PY{n}{maxProfit}\PY{p}{:} \PY{k+kt}{int}\PY{p}{,} \PY{n}{dp}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{profits}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validJobsSeq}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
  \PY{k}{requires} \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
  \PY{k}{requires} \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{n}{i} \PY{o}{\PYZlt{}} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
  \PY{k}{requires} \PY{o}{|}\PY{n}{dp}\PY{o}{|} \PY{o}{==} \PY{n}{i}
  \PY{k}{requires} \PY{o}{|}\PY{n}{profits}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}
  \PY{k}{requires} \PY{n}{profits}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{==} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}
  \PY{k}{requires} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZgt{}=} \PY{n}{maxProfit}
  \PY{k}{requires} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1} 
    \PY{o}{\PYZam{}\PYZam{}} \PY{n}{partialSolutionWithJobI}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)} 
        \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{maxProfit}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
  \PY{k}{requires} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i}  
    \PY{o}{\PYZam{}\PYZam{}} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)} 
        \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
  \PY{k}{ensures} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1} 
    \PY{o}{\PYZam{}\PYZam{}} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|}\PY{p}{)} 
        \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{profits}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
\PY{p}{\PYZob{}}
  \PY{k}{forall} \PY{n}{partialSol} \PY{o}{|} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1} 
    \PY{o}{\PYZam{}\PYZam{}} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|}\PY{p}{)}
    \PY{k}{ensures} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{profits}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)} 
    \PY{k}{if} \PY{n}{partialSol}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{==} \PY{l+m+mi}{1}
    \PY{p}{\PYZob{}}
      \PY{k}{assert} \PY{n}{maxProfit} \PY{o}{\PYZlt{}=} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{;}
      \PY{k}{assert} \PY{n}{profits}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{==} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{;}
      \PY{k}{assert} \PY{n}{maxProfit} \PY{o}{\PYZlt{}=} \PY{n}{profits}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{;}
    \PY{p}{\PYZcb{}}
    \PY{k}{else}
    \PY{p}{\PYZob{}}
      \PY{k}{assert} \PY{n}{partialSol}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{;}
      \PY{k}{assert} \PY{n}{partialSol}\PY{p}{[}\PY{p}{..}\PY{n}{i}\PY{p}{]} \PY{o}{+} \PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]} \PY{o}{==} \PY{n}{partialSol}\PY{p}{;}
      \PY{n}{NotAddingAJobKeepsSameProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{[}\PY{p}{..}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
      \PY{k}{assert} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{[}\PY{p}{..}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
       \PY{o}{==} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
      \PY{k}{assert} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{[}\PY{p}{..}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{o}{|}\PY{n}{partialSol}\PY{p}{[}\PY{p}{..}\PY{n}{i}\PY{p}{]}\PY{o}{|}\PY{p}{)}\PY{p}{;}
      \PY{k}{assert} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i}  
        \PY{o}{\PYZam{}\PYZam{}} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}
            \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
      \PY{k}{assert} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{[}\PY{p}{..}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)} \PY{o}{\PYZlt{}=} \PY{n}{dp} \PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{;} 
      \PY{k}{assert} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)} \PY{o}{\PYZlt{}=} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{;}
      \PY{k}{assert} \PY{n}{profits}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{==} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{;}
      \PY{k}{assert} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)} \PY{o}{\PYZlt{}=} \PY{n}{profits}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{;}
    \PY{p}{\PYZcb{}}
  \PY{p}{\PYZcb{}}
\PY{p}{\PYZcb{}}
\end{Verbatim}

    
    \item și \texttt{leadsToOptWithJobI}. Metoda \texttt{leadsToOptWithJobI} returnează soluția parțială optimă în cazul în care soluția parțială optimă ce conține activitatea i
    are profitul strict mai mare decât \texttt{dp[i-1]}, profitul care s-ar obține fără adăugare activității \texttt{i}. Pe această ramura soluția parțială optimă este cea care conține activitatea \texttt{i}.
\begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{method} \PY{n+nf}{leadsToOptWithJobI}\PY{p}{(}\PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{dp}\PY{p}{:}\PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,}
 {allSol}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{o}{\PYZgt{}}\PY{p}{,}\PY{n}{i}\PY{p}{:} \PY{k+kt}{int}\PY{p}{,} \PY{n}{maxProfit}\PY{p}{:} \PY{k+kt}{int}\PY{p}{,} 
 \PY{n}{optParSolWithJobI}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{)} 
 \PY{k}{returns} \PY{p}{(}\PY{n}{optimalPartialSolution}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{profits}\PY{p}{:}\PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validProblem}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
  \PY{k}{requires} \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{n}{i} \PY{o}{\PYZlt{}} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
  \PY{k}{requires} \PY{o}{|}\PY{n}{dp}\PY{o}{|} \PY{o}{==} \PY{o}{|}\PY{n}{allSol}\PY{o}{|} \PY{o}{==} \PY{n}{i}
  \PY{k}{requires} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{optParSolWithJobI}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
  \PY{k}{requires} \PY{n}{partialSolutionWithJobI}\PY{p}{(}\PY{n}{optParSolWithJobI}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}
  \PY{k}{requires} \PY{n}{maxProfit} \PY{o}{==} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{optParSolWithJobI}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
  \PY{k}{requires} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1} 
   \PY{o}{\PYZam{}\PYZam{}} \PY{n}{partialSolutionWithJobI}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)} \PY{o}{==}\PY{o}{\PYZgt{}} 
    \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{maxProfit}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
  \PY{k}{requires} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i}
    \PY{o}{\PYZam{}\PYZam{}} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)} \PY{o}{==}\PY{o}{\PYZgt{}} 
     \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
  \PY{k}{requires} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZlt{}} \PY{n}{maxProfit}
  \PY{k}{ensures} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{optimalPartialSolution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
  \PY{k}{ensures} \PY{o}{|}\PY{n}{profits}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}
  \PY{k}{ensures} \PY{n}{profits} \PY{o}{==} \PY{n}{dp} \PY{o}{+} \PY{p}{[}\PY{n}{maxProfit}\PY{p}{]}
  \PY{k}{ensures} \PY{n}{isOptParSol}\PY{p}{(}\PY{n}{optimalPartialSolution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
  \PY{k}{ensures} \PY{n}{HasProfit}\PY{p}{(}\PY{n}{optimalPartialSolution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{,} \PY{n}{profits}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}
  \PY{k}{ensures} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}
    \PY{o}{\PYZam{}\PYZam{}} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)} \PY{o}{==}\PY{o}{\PYZgt{}}
     \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{profits}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
\PY{p}{\PYZob{}}

  \PY{n}{profits} \PY{o}{:=} \PY{n}{dp} \PY{o}{+} \PY{p}{[}\PY{n}{maxProfit}\PY{p}{]}\PY{p}{;}
  \PY{k}{assert} \PY{n}{optParSolWithJobI}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{;}
  \PY{n}{optimalPartialSolution} \PY{o}{:=} \PY{n}{optParSolWithJobI}\PY{p}{;} 
  \PY{k}{assert} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{optimalPartialSolution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{;}
  \PY{k}{assert} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{optimalPartialSolution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)} \PY{o}{==} \PY{n}{maxProfit}\PY{p}{;}
  \PY{k}{assert} \PY{n}{partialSolutionWithJobI}\PY{p}{(}\PY{n}{optimalPartialSolution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}\PY{p}{;}
  \PY{n}{optimalPartialSolutionWithJobI}\PY{p}{(}\PY{n}{i}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{maxProfit}\PY{p}{,} \PY{n}{dp}\PY{p}{)}\PY{p}{;}
  \PY{k}{assert} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}  
   \PY{o}{\PYZam{}\PYZam{}} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}
        \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{profits}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
  \PY{k}{assert} \PY{n}{isOptParSol}\PY{p}{(}\PY{n}{optimalPartialSolution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{;}
\PY{p}{\PYZcb{}}
\end{Verbatim}
În cadrul acestei metode am folosit o lemă importantă, \\\texttt{optimalPartialSolutionWithJobI}. Această lemă demonstrează că soluția parțială optimă ce conține activitatea \texttt{i} este soluție parțială optimă pentru subproblema pe care o rezolvă.
\begin{Verbatim}[commandchars=\\\{\},fontsize=\footnotesize]
\PY{k+kd}{lemma} \PY{n+nf}{optimalPartialSolutionWithJobI}\PY{p}{(}\PY{n}{i}\PY{p}{:} \PY{k+kt}{int}\PY{p}{,} \PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{,}
 \PY{n}{maxProfit}\PY{p}{:} \PY{k+kt}{int}\PY{p}{,} \PY{n}{dp}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validJobsSeq}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
  \PY{k}{requires} \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
  \PY{k}{requires} \PY{o}{|}\PY{n}{dp}\PY{o}{|} \PY{o}{==} \PY{n}{i}
  \PY{k}{requires} \PY{l+m+mi}{1} \PY{o}{\PYZlt{}=} \PY{n}{i} \PY{o}{\PYZlt{}} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
  \PY{k}{requires} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZlt{}} \PY{n}{maxProfit}
  \PY{k}{requires} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i}
    \PY{o}{\PYZam{}\PYZam{}} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)} 
        \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
  \PY{k}{requires} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1} 
    \PY{o}{\PYZam{}\PYZam{}} \PY{n}{partialSolutionWithJobI}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)} 
        \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{maxProfit}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
  \PY{k}{ensures} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1} \PY{o}{\PYZam{}\PYZam{}}
   \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|}\PY{p}{)} 
   \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{maxProfit}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
\PY{p}{\PYZob{}}
  \PY{k}{forall} \PY{n}{partialSol} \PY{o}{|} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1} \PY{o}{\PYZam{}\PYZam{}}
   \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|}\PY{p}{)}
    \PY{k}{ensures} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{maxProfit}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
  \PY{p}{\PYZob{}}
    \PY{k}{if} \PY{n}{partialSol}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{==} \PY{l+m+mi}{1}
    \PY{p}{\PYZob{}}
      \PY{k}{assert} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}
       \PY{o}{\PYZam{}\PYZam{}} \PY{n}{partialSolutionWithJobI}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}
        \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{maxProfit}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
    \PY{p}{\PYZcb{}}
    \PY{k}{else}\PY{p}{\PYZob{}}
      \PY{n}{NotAddingAJobKeepsSameProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{[}\PY{p}{..}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
      \PY{k}{assert} \PY{n}{partialSol} \PY{o}{==} \PY{n}{partialSol}\PY{p}{[}\PY{p}{..}\PY{n}{i}\PY{p}{]} \PY{o}{+} \PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{;}
      \PY{k}{assert} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
        \PY{o}{==} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{[}\PY{p}{..}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
      \PY{n}{SubSeqOfPartialIsAlsoPartial}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}\PY{p}{;}
      \PY{k}{assert} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{[}\PY{p}{..}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{o}{|}\PY{n}{partialSol}\PY{p}{[}\PY{p}{..}\PY{n}{i}\PY{p}{]}\PY{o}{|}\PY{p}{)}\PY{p}{;}
      \PY{k}{assert} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{[}\PY{p}{..}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)} \PY{o}{\PYZlt{}=} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{;}
      \PY{k}{assert} \PY{n}{PartialSolProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}  \PY{o}{\PYZlt{}=} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{;}
      \PY{k}{assert} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZlt{}} \PY{n}{maxProfit}\PY{p}{;}
      \PY{k}{assert} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{maxProfit}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
    \PY{p}{\PYZcb{}}
  \PY{p}{\PYZcb{}}
\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{itemize}
Un rol important în demonstrarea acestor leme l-a avut invariantul 
\begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k}{invariant} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i}  \PY{o}{\PYZam{}\PYZam{}} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)} 
\PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{dp}\PY{p}{[}\PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)} 
\end{Verbatim}
din funcția principală \texttt{WeightedJobScheduling}, care ne asigură că secvența de profituri \texttt{dp} conține pentru fiecare subproblemă profiturile optime. 
\section{Mod de lucru}
De-a lungul procesului de dezvoltare a codului, au existat situații în care anumite metode și leme au cauzat depășirea timpului de așteptare (timeout). Acest lucru se întâmplă atunci când acestea conțin prea multe instrucțiuni care trebuie demonstrate, având un grad de complexitate crescut sau fac parte dintr-o clasă de probleme care nu poate fi rezolvată de solverul Z3.
Pentru a evita timeout-urile, soluția a constat în creșterea modularității prin refactorizarea  metodelor și lemelor care aveau această problemă, extrăgând parțile de cod critice pe care le-am demonstrat separat într-o alta lemă. Prin această abordare, nu doar că am reușit să reduc timpul de demonstrare, dar am reușit și să îmbunătățesc claritatea și modularitatea codului meu, făcându-l mai ușor de întreținut și de înțeles în viitor.

În timpul dezvoltării codului, un aspect important a fost modul de lucru. Pașii pe care i-am urmat pentru a-mi ușura munca au fost:
\begin{enumerate}
    \item utilizarea instrucțiunii \texttt{assume false} pentru a presupune că toate condițiile de verificare de după sunt adevărate (Dafny nu mai încearcă demonstrarea lor), încât să evit situațiile în care metodele deveneau fragile (duc la timeout) și nu mai puteam identifica la care linie este o eroare. 
    De cele mai multe ori, am folosit \texttt{assume false} în cazul if-urilor unde aveam două fire de execuție pentru a vedea exact pe care din cele două nu se respectă invarianții, deoarece de cele mai multe ori obțineam timeout și era dificil de identificat unde este problema. După ce pe o ramură obțineam un cod verificat, știam sigur că dacă problema încă este prezentă, trebuie să continui cu demonstrația pe cealaltă.
    De exemplu, în metoda principală a fost nevoie să presupun pe rând cele doua ramuri ale if-ului fiind adevărate, pentru a putea să lucrez pe fiecare în parte, încât să văd exact ce nu este bine și de ce.
    \begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{method} \PY{n+nf}{WeightedJobScheduling}\PY{p}{(}\PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{)} \PY{k}{returns} \PY{p}{(}\PY{n}{sol}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,}
 \PY{n}{profit} \PY{p}{:} \PY{k+kt}{int}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validProblem}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
  \PY{k}{ensures} \PY{n}{isSolution}\PY{p}{(}\PY{n}{sol}\PY{p}{,} \PY{n}{jobs}\PY{p}{)}
  \PY{k}{ensures} \PY{n}{isOptimalSolution}\PY{p}{(}\PY{n}{sol}\PY{p}{,} \PY{n}{jobs}\PY{p}{)}
\PY{p}{\PYZob{}}
  \PY{p}{..}\PY{p}{..}
  \PY{k}{while} \PY{n}{i} \PY{o}{\PYZlt{}} \PY{o}{|}\PY{n}{jobs}\PY{o}{|}
    \PY{p}{..}\PY{p}{.}
    \PY{k}{invariant} \PY{n}{isOptParSol}\PY{p}{(}\PY{n}{solution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)}
  \PY{p}{\PYZob{}}
    \PY{k+kd}{var} \PY{n}{maxProfit}\PY{p}{,} \PY{n}{optParSolWithI} \PY{o}{:=}
      \PY{n}{MaxProfitWithJobI}\PY{p}{(}\PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{dp}\PY{p}{,} \PY{n}{allSol}\PY{p}{)}\PY{p}{;}
    \PY{k}{if} \PY{n}{dp}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]} \PY{o}{\PYZgt{}=} \PY{n}{maxProfit} 
    \PY{p}{\PYZob{}}
      \PY{n}{solution}\PY{p}{,} \PY{n}{dp} \PY{o}{:=}
       \PY{n}{leadsToOptWithoutJobI}\PY{p}{(}\PY{n}{jobs}\PY{p}{,} \PY{n}{dp}\PY{p}{,} \PY{n}{allSol}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{maxProfit}\PY{p}{,} \PY{n}{solution}\PY{p}{)}\PY{p}{;}
      \PY{k}{assert} \PY{n}{isOptParSol}\PY{p}{(}\PY{n}{solution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{;}
    \PY{p}{\PYZcb{}}
    \PY{k}{else}
    \PY{p}{\PYZob{}}
      \PY{k}{assume} \PY{k+kc}{false}\PY{p}{;}
      \PY{n}{solution}\PY{p}{,} \PY{n}{dp} \PY{o}{:=} 
       \PY{n}{leadsToOptWithJobI}\PY{p}{(}\PY{n}{jobs}\PY{p}{,} \PY{n}{dp}\PY{p}{,} \PY{n}{allSol}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{maxProfit}\PY{p}{,} \PY{n}{optParSolWithI}\PY{p}{)}\PY{p}{;}
      \PY{k}{assert} \PY{n}{isOptParSol}\PY{p}{(}\PY{n}{solution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{)}\PY{p}{;}
    \PY{p}{\PYZcb{}}
    \PY{n}{allSol} \PY{o}{:=} \PY{n}{allSol} \PY{o}{+} \PY{p}{[}\PY{n}{solution}\PY{p}{]}\PY{p}{;} 
    \PY{n}{i} \PY{o}{:=} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1}\PY{p}{;}
  \PY{p}{\PYZcb{}}
  \PY{n}{sol} \PY{o}{:=} \PY{n}{solution}\PY{p}{;}
  \PY{n}{profit} \PY{o}{:=} \PY{n}{dp}\PY{p}{[}\PY{o}{|}\PY{n}{dp}\PY{o}{|}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{;}
\PY{p}{\PYZcb{}}
\end{Verbatim}
    \item utilizarea \texttt{assert-urilor} pentru a vedea exact de la ce linie o proprietatea nu mai este îndeplinită sau dacă am reușit să demonstrez o anumită proprietate. Assert-urile au fost instrucțiunile pe care le-am utilizat cel mai des pe parcursul dezvoltării codului în Dafny. Acestea m-au ajutat să verific proprietățile care trebuiau îndeplinite. În cazul predicatele mai complexe, definite print-o conjuncție cu mai multe propoziții, de cele mai multe ori foloseam assert pentru fiecare proprietate în parte, pentru a vedea care din ele nu este îndeplinită. 
    De exemplu, în cazul predicatului \texttt{isPartialSol}, de fiecare dată când făceam o modificare asupra unei soluții parțiale, verificam separat toate proprietățile sale. 
    \begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k+kd}{predicate} \PY{n+nf}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{length}\PY{p}{:} \PY{k+kt}{int}\PY{p}{)}
  \PY{k}{requires} \PY{n}{validJobsSeq}\PY{p}{(}\PY{n}{jobs}\PY{p}{)}
\PY{p}{\PYZob{}}
  \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{length} \PY{o}{\PYZam{}\PYZam{}}
  \PY{k}{forall} \PY{n}{i} \PY{p}{::} \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{i} \PY{o}{\PYZlt{}=} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{p}{(}\PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{partialSol}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{\PYZlt{}=} \PY{l+m+mi}{1}\PY{p}{)}
   \PY{o}{\PYZam{}\PYZam{}} \PY{n}{hasNoOverlappingJobs}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{)}
\PY{p}{\PYZcb{}}
\end{Verbatim}
În metoda \texttt{MaxProfitWithJobI} după ce am modificat variabila \texttt{partialSolution} am verificat dacă aceasta îndeplinește proprietatea de soluție parțială.
\begin{Verbatim}[commandchars=\\\{\},fontsize=\footnotesize]
\PY{k+kd}{method} \PY{n+nf}{MaxProfitWithJobI}\PY{p}{(}\PY{n}{jobs}\PY{p}{:} \PY{k+kt}{seq} \PY{o}{\PYZlt{}}\PY{n}{Job}\PY{o}{\PYZgt{}}\PY{p}{,} \PY{n}{i}\PY{p}{:} \PY{k+kt}{int}\PY{p}{,} \PY{n}{dp}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{,}
 \PY{n}{allSol} \PY{p}{:}\PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{o}{\PYZgt{}}\PY{p}{)}
 \PY{k}{returns} \PY{p}{(}\PY{n}{maxProfit}\PY{p}{:}\PY{k+kt}{int}\PY{p}{,} \PY{n}{optParSolWithI}\PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}}\PY{p}{)}
  \PY{p}{..}\PY{p}{.}
  \PY{k}{ensures} \PY{k}{forall} \PY{n}{partialSol} \PY{p}{::} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1} \PY{o}{\PYZam{}\PYZam{}}
   \PY{n}{partialSolutionWithJobI}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{)} \PY{o}{==}\PY{o}{\PYZgt{}}
    \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{maxProfit}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}
\PY{p}{\PYZob{}}

  \PY{k+kd}{var} \PY{n}{max\PYZus{}profit} \PY{o}{:=} \PY{l+m+mi}{0}\PY{p}{;}
  \PY{k+kd}{var} \PY{n}{partialSolutionPrefix} \PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}} \PY{o}{:=} \PY{p}{[}\PY{p}{]}\PY{p}{;}
  \PY{k+kd}{var} \PY{n}{partialSolution} \PY{p}{:} \PY{k+kt}{seq}\PY{o}{\PYZlt{}}\PY{k+kt}{int}\PY{o}{\PYZgt{}} \PY{o}{:=} \PY{p}{[}\PY{p}{]}\PY{p}{;}
  \PY{k+kd}{var} \PY{n}{j} \PY{o}{:=} \PY{n}{i} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{;}
  \PY{k+kd}{var} \PY{n}{length} \PY{o}{:=} \PY{l+m+mi}{0}\PY{p}{;}
  
  \PY{k}{while} \PY{n}{j} \PY{o}{\PYZgt{}=} \PY{l+m+mi}{0} \PY{o}{\PYZam{}\PYZam{}} \PY{n}{jobs}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{.}\PY{n}{jobEnd} \PY{o}{\PYZgt{}} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{.}\PY{n}{jobStart} \PY{c+c1}{//}
    \PY{p}{..}\PY{p}{.}
    \PY{k}{invariant} \PY{k}{forall} \PY{n}{k} \PY{p}{::} \PY{n}{j} \PY{o}{\PYZlt{}} \PY{n}{k} \PY{o}{\PYZlt{}} \PY{n}{i} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{n}{overlappingJobs}\PY{p}{(}\PY{n}{jobs}\PY{p}{[}\PY{n}{k}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)} 
  \PY{p}{\PYZob{}}
    \PY{n}{j} \PY{o}{:=} \PY{n}{j} \PY{o}{\PYZhy{}} \PY{l+m+mi}{1}\PY{p}{;}
  \PY{p}{\PYZcb{}}
  \PY{k}{assert}  \PY{n}{j} \PY{o}{!=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{err}{!}\PY{n}{overlappingJobs}\PY{p}{(}\PY{n}{jobs}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{p}{;}
  \PY{k}{if} \PY{n}{j} \PY{o}{\PYZgt{}=} \PY{l+m+mi}{0}
  \PY{p}{\PYZob{}}
    \PY{n}{max\PYZus{}profit}\PY{p}{,} \PY{n}{partialSolution}\PY{p}{,} \PY{n}{length} \PY{o}{:=}
     \PY{n}{OptParSolWhenNonOverlapJob}\PY{p}{(}\PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{dp}\PY{p}{,} \PY{n}{allSol}\PY{p}{,} \PY{n}{j}\PY{p}{)}\PY{p}{;}
  \PY{p}{\PYZcb{}}
  \PY{k}{else} 
  \PY{p}{\PYZob{}}
    \PY{n}{max\PYZus{}profit}\PY{p}{,} \PY{n}{partialSolution}\PY{p}{,} \PY{n}{length} \PY{o}{:=} 
    \PY{n}{OptParSolWhenOverlapJob}\PY{p}{(}\PY{n}{jobs}\PY{p}{,} \PY{n}{i}\PY{p}{,} \PY{n}{dp}\PY{p}{)}\PY{p}{;}
  \PY{p}{\PYZcb{}}
  \PY{k}{assert} \PY{k}{forall} \PY{n}{k} \PY{p}{::} \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{k} \PY{o}{\PYZlt{}} \PY{n}{length} \PY{o}{==}\PY{o}{\PYZgt{}} \PY{l+m+mi}{0} \PY{o}{\PYZlt{}=} \PY{n}{partialSolution}\PY{p}{[}\PY{n}{k}\PY{p}{]} \PY{o}{\PYZlt{}=} \PY{l+m+mi}{1}\PY{p}{;} 
  \PY{k}{assert} \PY{n}{hasNoOverlappingJobs}\PY{p}{(}\PY{n}{partialSolution}\PY{p}{,} \PY{n}{jobs}\PY{p}{)}\PY{p}{;}
  \PY{k}{assert} \PY{o}{|}\PY{n}{partialSolution}\PY{o}{|} \PY{o}{==} \PY{n}{length}\PY{p}{;}
  \PY{k}{assert} \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSolution}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{length}\PY{p}{)}\PY{p}{;}
  \PY{p}{..}\PY{p}{.}
\PY{p}{\PYZcb{}}
\end{Verbatim}


Au fost și cazuri în care a trebuit să folosesc assert-uri deoarece Dafny are nevoie de indicii să demonstreze proprietăți care păreau evidente pentru o persoană, dar care fac parte dintr-o clasă de formule nedecidabilă. De exemplu assert-ul \texttt{assert partialSol == partialSol[..i] + [0]} din următoarea bucată de cod este necesar:
\begin{tiny}
\begin{Verbatim}[commandchars=\\\{\}, fontsize=\footnotesize]
\PY{k}{forall} \PY{n}{partialSol} \PY{o}{|} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|} \PY{o}{==} \PY{n}{i} \PY{o}{+} \PY{l+m+mi}{1} \PY{o}{\PYZam{}\PYZam{}} 
 \PY{n}{isPartialSol}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{o}{|}\PY{n}{partialSol}\PY{o}{|}\PY{p}{)}
    \PY{k}{ensures} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{maxProfit}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
  \PY{p}{\PYZob{}}
    \PY{k}{if} \PY{n}{partialSol}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{==} \PY{l+m+mi}{1}
    \PY{p}{\PYZob{}}
      \PY{p}{..}\PY{p}{.}
    \PY{p}{\PYZcb{}}
    \PY{k}{else}\PY{p}{\PYZob{}}
      \PY{n}{NotAddingAJobKeepsSameProfit}\PY{p}{(}\PY{n}{partialSol}\PY{p}{[}\PY{p}{..}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}
      \PY{k}{assert} \PY{n}{partialSol} \PY{o}{==} \PY{n}{partialSol}\PY{p}{[}\PY{p}{..}\PY{n}{i}\PY{p}{]} \PY{o}{+} \PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{;}
      \PY{p}{..}\PY{p}{.}
      \PY{k}{assert} \PY{n}{HasLessProf}\PY{p}{(}\PY{n}{partialSol}\PY{p}{,} \PY{n}{jobs}\PY{p}{,} \PY{n}{maxProfit}\PY{p}{,} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{;}\PY{p}{\PYZcb{}}
\end{Verbatim}
\end{tiny}
\end{enumerate}


















